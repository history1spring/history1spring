<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1914-1918: The Great War</title>
    <style>
        /* --- ê¸°ë³¸ í…Œë§ˆ --- */
        :root {
            --bg-color: #1a1814;
            --text-color: #ccc;
            --accent-gold: #c5a065;
            --btn-bg: #2a2a2a;
            --item-green: #2e7d32;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            line-height: 1.7;
            background-image: radial-gradient(#2a2a2a 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #game-container {
            width: 900px;
            max-width: 95%;
            background-color: #2e2b26;
            padding: 50px;
            border: 2px solid #5c5042;
            box-shadow: 0 20px 60px rgba(0,0,0,0.95);
            position: relative;
            display: none;
        }

        /* --- [UI] ìƒë‹¨ í—¤ë” --- */
        .game-header {
            border-bottom: 1px solid #4a4a4a;
            padding-bottom: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .game-title {
            color: var(--accent-gold);
            font-weight: bold;
            font-size: 1.4em;
            font-family: 'Times New Roman', serif;
            margin-bottom: 5px;
        }
        .game-subtitle {
            color: #aaa;
            font-size: 1em;
            font-weight: bold;
        }
        .stage-box {
            text-align: right;
            color: #aaa;
        }

        /* --- [UI] ìƒíƒœì°½ (ê°€ë¡œí˜•) --- */
        .stats-panel {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 25px;
            background: #1f1d1a;
            padding: 20px;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
        }
        .stat-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-header {
            width: 100%; display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9em; color: #aaa; font-weight: bold;
        }
        .stat-bar-bg { 
            width: 100%; height: 12px; background: #111; 
            border: 1px solid #444; border-radius: 2px; overflow: hidden; 
        }
        .stat-bar-fill { height: 100%; transition: width 0.5s; width: 100%; }
        .blind-bar { width: 100% !important; background-color: #333 !important; }

        /* --- [UI] ì¸ë²¤í† ë¦¬ --- */
        .inventory-wrapper {
            background: #1f1d1a;
            border: 1px solid #4a4a4a;
            padding: 15px 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px;
        }
        .inv-label { font-weight: bold; color: var(--accent-gold); margin-right: 10px; }
        .inv-slots { display: flex; gap: 15px; }
        .inv-slot {
            width: 55px; height: 55px; background-color: #141414;
            border: 2px solid #3d3d3d; border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            font-size: 2em; cursor: help; position: relative; transition: 0.2s;
        }
        .inv-slot:hover { border-color: var(--accent-gold); transform: translateY(-2px); }
        .inv-slot.empty { opacity: 0.2; font-size: 1em; color: #555; border-style: dashed; }
        
        .inv-slot .tooltip {
            visibility: hidden; min-width: 100px; background-color: #000;
            color: #fff; text-align: center; border-radius: 4px; padding: 8px 12px;
            position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%);
            font-size: 0.85rem; z-index: 10; border: 1px solid #555; white-space: nowrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.8);
        }
        .inv-slot:hover .tooltip { visibility: visible; opacity: 1; }

        /* --- í…ìŠ¤íŠ¸ ë° ì„ íƒì§€ --- */
        #scenario-text {
            font-size: 1.3em; line-height: 1.8; margin-bottom: 35px;
            white-space: pre-wrap; min-height: 120px; color: #f0f0f0;
            border-left: 5px solid #5c5042; padding: 20px 30px;
            background: rgba(0,0,0,0.25); border-radius: 4px;
        }

        .btn-group { display: flex; flex-direction: column; gap: 15px; }
        
        .choice-btn {
            padding: 22px; background-color: var(--btn-bg); color: #ccc;
            border: 1px solid #444; width: 100%; text-align: left;
            cursor: pointer; font-size: 1.15em; transition: 0.2s; 
            font-family: inherit; font-weight: bold; border-radius: 6px;
        }
        .choice-btn:hover { 
            background-color: #383838; color: var(--accent-gold); 
            border-left: 5px solid var(--accent-gold); padding-left: 27px; 
        }

        /* ì•„ì´í…œ íšë“ ë²„íŠ¼ (ë…¹ìƒ‰) */
        .get-item-btn { background-color: #1b2e1e; border: 1px solid #4caf50; color: #81c784; }
        .get-item-btn:hover { background-color: #2a472e; color: #fff; border-left-color: #4caf50; }

        /* ì•„ì´í…œ ì‚¬ìš©/ê±°ë˜ ë²„íŠ¼ */
        .use-item-btn { background-color: #152215; border: 1px solid #66bb6a; }
        .trade-btn { background-color: #2b2500; border: 1px solid #ffd700; color: #ffe066; }
        
        /* í•˜ë“œëª¨ë“œ ë²„íŠ¼ */
        .hard-mode-btn { border: 1px solid #555 !important; background: #222 !important; color: #ccc !important; }
        .hard-mode-btn:hover { border-color: var(--accent-gold) !important; color: #fff !important; }

        .tag { font-size: 0.75em; padding: 3px 10px; border-radius: 4px; float: right; margin-left: 10px; font-weight: bold; color: #000; }
        .tag-get { background: #4caf50; }
        .tag-use { background: #66bb6a; } 
        .tag-trade { background: #ffd700; }

        /* ê²°ê³¼ í”¼ë“œë°± íš¨ê³¼ */
        #feedback-area {
            background: #1f1d1a; border: 2px solid var(--accent-gold); 
            padding: 30px; margin-bottom: 30px; display: none; 
            color: #e0c097; line-height: 1.7; font-size: 1.1em;
            animation: slideUpFade 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .fact-title { font-weight: bold; display: block; margin-bottom: 15px; color: #fff; font-size: 1.2em; border-bottom: 1px solid #444; padding-bottom: 10px;}

        /* ë‹¤ìŒ ì¥ ë²„íŠ¼ */
        .next-btn {
            background-color: #3e3625; color: #fff; border: 1px solid var(--accent-gold);
            text-align: center; margin-top: 10px;
        }
        .next-btn:hover {
            background-color: var(--accent-gold); color: #000; border-color: #fff;
            padding-left: 22px;
        }

        /* ëœë¤ ì´ë²¤íŠ¸ ì•Œë¦¼ */
        #random-event-msg { background: #1b3320; border: 1px solid #4caf50; color: #81c784; padding: 15px; margin-bottom: 20px; display: none; text-align: center; font-weight: bold; animation: slideDown 0.5s; }

        /* ì§„í–‰ë„ */
        .progress-container { width: 100%; background: #222; height: 8px; margin-bottom: 15px; border-radius: 4px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--accent-gold); width: 0%; transition: width 0.5s; }
        
        /* ì‹œì‘ í™”ë©´ UI */
        #start-screen { width: 800px; max-width: 95%; background-color: #2e2b26; padding: 60px; border: 2px solid #5c5042; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.9); }
        h1 { color: var(--accent-gold); font-family: 'Times New Roman', serif; letter-spacing: 2px; margin-bottom: 10px; font-size: 2.5em; }
        .intro-affiliation { color: #aaa; font-size: 1.1em; margin-bottom: 40px; font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 20px; display: inline-block; }
        
        .difficulty-btn { display: block; width: 100%; margin: 15px 0; padding: 25px; font-size: 1.2em; cursor: pointer; border: 1px solid #555; background: #222; color: #ccc; font-weight: bold; transition:0.3s; }
        .difficulty-btn:hover { background: #333; border-color: var(--accent-gold); color: #fff; transform: scale(1.02); }
        
        .footer-credit { margin-top: 50px; padding-top: 20px; border-top: 1px solid #444; text-align: center; font-size: 0.9em; color: #666; }
        .typewriter-cursor::after { content: 'â–ˆ'; animation: blink 0.8s infinite; color: var(--accent-gold); margin-left: 5px;}
        .highlight-text { color: #ffd700; text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .danger { color: #ff4444 !important; animation: blink 1.5s infinite; }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; height: 0; } to { opacity: 1; height: auto; } }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>1914 - 1918<br>THE GREAT WAR</h1>
    <div class="intro-affiliation">ì†Œì†: 3êµ­ í˜‘ìƒ (ì˜êµ­êµ° ì œ4ë³´ë³‘ì—°ëŒ€)</div>
    
    <button class="difficulty-btn" onclick="selectDifficulty('normal')">
        <strong>ì§•ì§‘ë³‘ (NORMAL)</strong><br>
        <span style="font-size: 0.8em; color: #888;">[ì¶”ì²œ] íŒíŠ¸ ì œê³µ / ê²Œì´ì§€ í‘œì‹œ</span>
    </button>
    
    <button class="difficulty-btn" onclick="selectDifficulty('hard')">
        <strong>ë² í…Œë‘ (VETERAN)</strong><br>
        <span style="font-size: 0.8em; color: #888;">[ë¦¬ì–¼ë¦¬ì¦˜] íŒíŠ¸ ì—†ìŒ / ê²Œì´ì§€ ìˆ¨ê¹€</span>
    </button>
</div>

<div id="game-container">
    <div class="game-header">
        <div>
            <div class="game-title">1914-1918: TRENCH SURVIVOR</div>
        </div>
        <div class="stage-box">
            <span id="stage-text" style="font-weight:bold; font-size:1.1em; color:#ddd;">ì…ëŒ€ì¼</span><br>
            <span style="font-size:0.8em; opacity:0.6;">(20 Stages)</span>
        </div>
    </div>
    
    <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>

    <div class="stats-panel">
        <div class="stat-box">
            <div class="stat-header"><span>PHYSICAL (ì‹ ì²´)</span> <span id="hp-text">100</span></div>
            <div class="stat-bar-bg"><div id="hp-bar" class="stat-bar-fill" style="width:100%; background:#d64545;"></div></div>
        </div>
        <div class="stat-box">
            <div class="stat-header"><span>MENTAL (ì •ì‹ )</span> <span id="moral-text">100</span></div>
            <div class="stat-bar-bg"><div id="moral-bar" class="stat-bar-fill" style="width:100%; background:#4dabf7;"></div></div>
        </div>
        <div class="stat-box">
            <div class="stat-header"><span>HUMANITY (ì¸ë¥˜ì• )</span> <span id="human-text">??</span></div>
            <div class="stat-bar-bg"><div id="human-bar" class="stat-bar-fill" style="width:50%; background:#69db7c;"></div></div>
        </div>
    </div>

    <div class="inventory-wrapper">
        <span class="inv-label">ğŸ’ BELT KITS:</span>
        <div class="inv-slots" id="inv-grid">
            <div class="inv-slot empty">+</div><div class="inv-slot empty">+</div><div class="inv-slot empty">+</div><div class="inv-slot empty">+</div>
        </div>
    </div>

    <div id="random-event-msg"></div>
    <div id="feedback-area"></div>
    <div id="scenario-text"></div>
    <div id="choices" class="btn-group"></div>

    <div class="footer-credit">Developed by <span>Son Seoyul</span></div>
</div>

<script>
    const TOTAL_STAGES = 20;
    
    const itemData = {
        'ê°€ì¡±ì‚¬ì§„': { icon: 'ğŸ–¼ï¸', desc: 'ê°€ì¡±ì‚¬ì§„' },
        'ì£¼ë¨¸ë‹ˆì¹¼': { icon: 'ğŸ”ª', desc: 'ì£¼ë¨¸ë‹ˆì¹¼' },
        'ì´ˆì½œë¦¿': { icon: 'ğŸ«', desc: 'ì´ˆì½œë¦¿' },
        'ê¸ˆíšŒì¤‘ì‹œê³„': { icon: 'ğŸ•°ï¸', desc: 'ê¸ˆíšŒì¤‘ì‹œê³„' },
        'ì•½': { icon: 'ğŸ’Š', desc: 'í•­ìƒì œ' }
    };

    let state = { difficulty: 'normal', hp: 100, moral: 100, humanity: 50, inventory: [], step: 0, scene: 'intro' };

    function selectDifficulty(mode) {
        state.difficulty = mode;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        if (mode === 'hard') { state.hp = 80; state.moral = 80; }
        updateUI(); renderScene();
    }

    function updateInventoryUI() {
        const grid = document.getElementById('inv-grid');
        grid.innerHTML = '';
        for (let i = 0; i < 4; i++) {
            const slot = document.createElement('div');
            if (i < state.inventory.length) {
                const itemName = state.inventory[i];
                const item = itemData[itemName] || { icon: 'ğŸ“¦', desc: itemName };
                slot.className = 'inv-slot';
                slot.innerHTML = `${item.icon}<span class="tooltip">${item.desc}</span>`;
            } else { slot.className = 'inv-slot empty'; slot.innerText = '+'; }
            grid.appendChild(slot);
        }
    }

    const randomDrops = { 's3': 'ì£¼ë¨¸ë‹ˆì¹¼', 's7': 'ê°€ì¡±ì‚¬ì§„', 's11': 'ì´ˆì½œë¦¿' };

    function checkRandomDrop(scene) {
        if (!randomDrops[scene]) return; 
        const targetItem = randomDrops[scene];
        if (state.inventory.includes(targetItem)) return; 
        const chance = state.difficulty === 'hard' ? 0.3 : 0.6;
        if (Math.random() < chance) {
            state.inventory.push(targetItem);
            const msgBox = document.getElementById('random-event-msg');
            msgBox.innerHTML = `<strong>ğŸ€ í–‰ìš´!</strong> ì£¼ë³€ì—ì„œ <strong>[${targetItem}]</strong>ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!`;
            msgBox.style.display = 'block';
            setTimeout(() => { msgBox.style.display = 'none'; }, 4000);
            updateUI();
        }
    }

    // 20ë‹¨ê³„ ì‹œë‚˜ë¦¬ì˜¤
    const scenarios = {
        'intro': { text: "1914ë…„ 8ì›”, ì „ìŸì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.\n'ë‚™ì—½ì´ ì§€ê¸° ì „ì— ì§‘ì— ëŒì•„ì˜¨ë‹¤'ëŠ” ë§ì„ ë¯¿ê³  ì…ëŒ€í–ˆìŠµë‹ˆë‹¤.\në– ë‚˜ëŠ” ê¸°ì°¨ ì•ˆ, ë¶ˆì•ˆí•œ ë§ˆìŒì— ì§‘ì—ì„œ ê°€ì ¸ì˜¨ ë¬¼ê±´ í•˜ë‚˜ë¥¼ ì£¼ë¨¸ë‹ˆì— ë„£ìŠµë‹ˆë‹¤. ë¬´ì—‡ì…ë‹ˆê¹Œ?", choices: [ { text: "ì–´ë¨¸ë‹ˆê°€ ì£¼ì‹  'ê°€ì¡±ì‚¬ì§„'", next: 's1', item: 'ê°€ì¡±ì‚¬ì§„', feedback: "ê°€ì¡±ì‚¬ì§„ì„ ì±™ê²¼ìŠµë‹ˆë‹¤." }, { text: "ì•„ë²„ì§€ê°€ ì“°ì‹œë˜ 'ì£¼ë¨¸ë‹ˆì¹¼'", next: 's1', item: 'ì£¼ë¨¸ë‹ˆì¹¼', feedback: "ì£¼ë¨¸ë‹ˆì¹¼ì„ ì±™ê²¼ìŠµë‹ˆë‹¤." }, { text: "ë™ìƒì´ ì±™ê²¨ì¤€ 'ì´ˆì½œë¦¿'", next: 's1', item: 'ì´ˆì½œë¦¿', feedback: "ì´ˆì½œë¦¿ì„ ì±™ê²¼ìŠµë‹ˆë‹¤." } ] },
        's1': { text: "[1/20] 1914ë…„ 9ì›”: ëì—†ëŠ” ì‚½ì§ˆ\ní”„ë‘ìŠ¤ ì „ì„ ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. ì „íˆ¬ ëŒ€ì‹  ì‚½ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.\nì ì˜ í¬ê²©ì´ ì–¸ì œ ì‹œì‘ë ì§€ ëª¨ë¥´ëŠ” ê¸´ë°•í•œ ìƒí™©ì…ë‹ˆë‹¤.", choices: [ { text: "ì²´ë ¥ì„ ì•„ë¼ê¸° ìœ„í•´ ì–•ê²Œ íŒë‹¤.", next: 's2', hp: +5, moral: -5, feedback: "ğŸ©¹ [íŒë‹¨ ë¯¸ìŠ¤] ëª¸ì€ í¸í–ˆì§€ë§Œ, ì–•ì€ ì°¸í˜¸ëŠ” í¬ê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤." }, { text: "ì†ì´ í„°ì§€ë”ë¼ë„ ê¹Šê³  íŠ¼íŠ¼í•˜ê²Œ íŒë‹¤.", next: 's2', hp: -10, moral: +10, feedback: "ğŸ› ï¸ [ì˜¬ë°”ë¥¸ íŒë‹¨] ê¹Šì€ ì°¸í˜¸ë§Œì´ í¬íƒ„ íŒŒí¸ì„ ë§‰ì•„ì¤ë‹ˆë‹¤." } ] },
        's2': { text: "[2/20] 1914ë…„ 10ì›”: ì°¸í˜¸ì˜ ë¶ˆì²­ê°\nì”»ì§€ ëª»í•´ ì˜¨ëª¸ì´ ê°€ë µê³ , ì‹œì²´ë¥¼ ë¨¹ê³  ìë€ ì¥ë“¤ì´ ì‹ëŸ‰ì„ ë…¸ë¦½ë‹ˆë‹¤.\nì–´ë–»ê²Œ ëŒ€ì²˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", choices: [ { text: "ì˜·ì„ ë²—ì–´ í„¸ê³  ì°¬ë¬¼ë¡œ ì”»ëŠ”ë‹¤.", next: 's3', hp: -5, moral: -5, feedback: "âŒ [ì˜¤ë‹µ] ì°¨ê°€ìš´ ì°¸í˜¸ì—ì„œ ì”»ëŠ” ê±´ ì €ì²´ì˜¨ì¦ì˜ ì§€ë¦„ê¸¸ì…ë‹ˆë‹¤. ì´(Lice)ëŠ” ë¬¼ë¡œ ì£½ì§€ ì•ŠìŠµë‹ˆë‹¤." }, { text: "ì˜· ì†”ê¸°ì˜ ì´ë¥¼ ì´›ë¶ˆë¡œ íƒœì›Œ ì£½ì¸ë‹¤.", next: 's3', moral: +5, feedback: "ğŸ”¥ [ì •ë‹µ] ë³‘ì‚¬ë“¤ì˜ ì¼ìƒì¸ 'ì´ ì¡ê¸°'ì…ë‹ˆë‹¤. ì´ê²ƒë§Œì´ í•´ê²°ì±…ì…ë‹ˆë‹¤." } ] },
        's3': { text: "[3/20] 1914ë…„ 11ì›”: ì•¼ê°„ ë³´ì´ˆ\nì–´ë‘  ì†, ì² ì¡°ë§ì—ì„œ ë¶€ìŠ¤ëŸ­ê±°ë¦¬ëŠ” ì†Œë¦¬ê°€ ë“¤ë¦½ë‹ˆë‹¤.\nì ì˜ ì¹¨íˆ¬ì¼ê¹Œìš”?", choices: [ { text: "ìœ„í—˜í•˜ë‹¤. ì¦‰ì‹œ ì‚¬ê²©í•˜ì—¬ ì œì••í•œë‹¤.", next: 's4', moral: -10, feedback: "ğŸ’¥ [ì‹¤ìˆ˜] ë‹¨ìˆœí•œ ë“¤ì¥ì˜€ìŠµë‹ˆë‹¤. ì´ì„± ë•Œë¬¸ì— ì•„êµ° ìœ„ì¹˜ê°€ ë…¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤." }, { text: "ìˆ¨ì„ ì£½ì´ê³  ëê¹Œì§€ ê´€ì°°í•œë‹¤.", next: 's4', moral: +5, feedback: "ğŸ‘€ [ëƒ‰ì² í•¨] ë°”ëŒì— ë‚ ë¦° ë¤ë¶ˆì´ì—ˆìŠµë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ êµì „ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤." } ] },
        's4': { text: "[4/20] 1914ë…„ 12ì›” 24ì¼: í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì •ì „\nì êµ° ì°¸í˜¸ì—ì„œ ìºëŸ´ì´ ë“¤ë¦½ë‹ˆë‹¤. ë³‘ì‚¬ë“¤ì´ ë¬´ê¸°ë¥¼ ë†“ê³  ë‚˜ê°‘ë‹ˆë‹¤.\nìƒë¶€ì˜ ëª…ë ¹ì€ 'ì ê³¼ ë‚´í†µ ê¸ˆì§€'ì…ë‹ˆë‹¤.", choices: [ { text: "ëª…ë ¹ì„ ì–´ê¸°ê³  ë‚˜ê°€ ì„ ë¬¼ì„ êµí™˜í•œë‹¤.", next: 's5', humanity: +30, moral: +20, feedback: "ğŸ„ [ì—­ì‚¬ì  ì‚¬ê±´] ì„œë¶€ì „ì„  ê³³ê³³ì—ì„œ ê¸°ì  ê°™ì€ í‰í™”ê°€ ì°¾ì•„ì™”ìŠµë‹ˆë‹¤." }, { text: "í•¨ì •ì¼ ìˆ˜ ìˆë‹¤. ì°¸í˜¸ë¥¼ ì§€í‚¨ë‹¤.", next: 's5', humanity: -10, feedback: "ğŸ›¡ï¸ [êµ°ì¸ ì •ì‹ ] ì•ˆì „ì„ íƒí–ˆì§€ë§Œ, ì—­ì‚¬ìƒ ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ìˆœê°„ì„ ë†“ì³¤ìŠµë‹ˆë‹¤." } ] },
        's5': { text: "[5/20] 1915ë…„ 2ì›”: ì§„í™íƒ•\nê²¨ìš¸ë¹„ë¡œ ì°¸í˜¸ê°€ ë¬¼ë°”ë‹¤ì…ë‹ˆë‹¤. ë°œì´ í‰í‰ ë¶“ìŠµë‹ˆë‹¤.\nì–´ë–»ê²Œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", choices: [ { text: "ì²´ì˜¨ ìœ ì§€ë¥¼ ìœ„í•´ ì –ì€ ì–‘ë§ ìœ„ì— ë‹´ìš”ë¥¼ ë®ëŠ”ë‹¤.", next: 's6', damage: 20, feedback: "âŒ [ì˜¤ë‹µ] ìŠµê¸°ê°€ ê°‡í˜€ ë°œì´ ë” ë¹¨ë¦¬ ì©ìŠµë‹ˆë‹¤. ì°¸í˜¸ì¡±ì˜ ì›ì¸ì€ ìŠµê¸°ì…ë‹ˆë‹¤." }, { text: "ë§ˆë¥¸ ì–‘ë§ì„ ì‹ ê³  ê³ ë˜ ê¸°ë¦„ì„ ë°”ë¥¸ë‹¤.", next: 's6', bonus: 10, feedback: "âœ… [ì •ë‹µ] ë°œì„ ê±´ì¡°í•˜ê²Œ í•˜ê³  ê¸°ë¦„ìœ¼ë¡œ ì½”íŒ…í•´ì•¼ í•©ë‹ˆë‹¤." } ] },
        's6': { text: "[6/20] 1915ë…„ 3ì›”: ë¬´ì¸ ì§€ëŒ€ì˜ ì „ë¦¬í’ˆ\nìˆœì°° ì¤‘ ì „ì‚¬í•œ ë…ì¼êµ° ì¥êµì˜ ì‹œì‹ ì—ì„œ 'ê¸ˆíšŒì¤‘ì‹œê³„'ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.", choices: [ { text: "ì£½ì€ ìì˜ ë¬¼ê±´ì´ë‹¤. ê±´ë“œë¦¬ì§€ ì•ŠëŠ”ë‹¤.", next: 's7', humanity: +20, feedback: "ğŸ•Šï¸ [ì–‘ì‹¬] ë¹ˆì†ìœ¼ë¡œ ëŒì•„ì™”ì§€ë§Œ, ì¡´ì—„ì€ ì§€ì¼°ìŠµë‹ˆë‹¤." }, { text: "ì±™ê¸´ë‹¤. ì „ìŸí„°ì—ì„œ ì–‘ì‹¬ì´ ë°¥ ë¨¹ì—¬ì£¼ë‚˜?", next: 's7', item: 'ê¸ˆíšŒì¤‘ì‹œê³„', humanity: -20, feedback: "ğŸ’° [íšë“] 'ê¸ˆíšŒì¤‘ì‹œê³„'ë¥¼ ì±™ê²¼ìŠµë‹ˆë‹¤." } ] },
        's7': { text: "[7/20] 1915ë…„ 4ì›”: ì´í”„ë¥´ì˜ ì•ˆê°œ\në…ì¼êµ° ì§„ì˜ì—ì„œ ë…¹í™©ìƒ‰ ê°€ìŠ¤(ì—¼ì†Œ)ê°€ í”¼ì–´ì˜¤ë¦…ë‹ˆë‹¤.\në°©ë…ë©´ì€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.", choices: [ { text: "ë³¸ëŠ¥ì ìœ¼ë¡œ ì°¸í˜¸ ë°”ë‹¥ ê¹Šì€ ê³³ì— ì—ë“œë¦°ë‹¤.", next: 's8', damage: 40, feedback: "âŒ [ì‚¬ë§ ìœ„í—˜] ë…ê°€ìŠ¤ëŠ” ê³µê¸°ë³´ë‹¤ ë¬´ê±°ì›Œ ë°”ë‹¥ì— ê³ ì…ë‹ˆë‹¤." }, { text: "ì˜¤ì¤Œ ë¬»ì€ ì²œìœ¼ë¡œ ì…ì„ ë§‰ê³  ë†’ì€ ê³³ìœ¼ë¡œ ë›´ë‹¤.", next: 's8', hp: -10, bonus: 10, feedback: "âœ… [ê³¼í•™ì  ëŒ€ì²˜] ì•”ëª¨ë‹ˆì•„ê°€ ì—¼ì†Œë¥¼ ì¤‘í™”ì‹œí‚µë‹ˆë‹¤." } ] },
        's8': { text: "[8/20] 1915ë…„ ë°¤: ì² ì¡°ë§\nì •ì°° ì¤‘ ì˜·ì´ ì² ì¡°ë§ì— ê±¸ë ¸ìŠµë‹ˆë‹¤. ì ì˜ ì¡°ëª…íƒ„ì´ í„°ì§€ê¸° ì§ì „ì…ë‹ˆë‹¤.", choices: [ { text: "ì‚´ì ì´ ëœ¯ê¸°ë”ë¼ë„ ì–µì§€ë¡œ ëª¸ì„ ë¹„íŠ¼ë‹¤.", next: 's9', damage: 20, feedback: "ğŸ©¸ [ë¶€ìƒ] íƒˆì¶œí–ˆì§€ë§Œ ê¹Šì€ ìƒì²˜ë¥¼ ì…ì—ˆìŠµë‹ˆë‹¤." }, { text: "ì£¼ë¨¸ë‹ˆì¹¼ì„ êº¼ë‚´ ì² ì¡°ë§ì„ ëŠëŠ”ë‹¤.", next: 's9', req: 'ì£¼ë¨¸ë‹ˆì¹¼', bonus: 5, feedback: "âœ¨ [ì•„ì´í…œ ì‚¬ìš©] ì¹¼ ë•ë¶„ì— ì¡°ìš©íˆ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤." } ] },
        's9': { text: "[9/20] 1916ë…„ 2ì›”: ë² ë¥´ë­ ì „íˆ¬\n3ì¼ ë°¤ë‚®ìœ¼ë¡œ í¬íƒ„ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤. ê³µí¬ê°€ ë‹¹ì‹ ì„ ì§‘ì–´ì‚¼í‚¤ë ¤ í•©ë‹ˆë‹¤.", choices: [ { text: "ì°¸í˜¸ êµ¬ì„ì—ì„œ ê·€ë¥¼ ë§‰ê³  ë¹„ëª…ì„ ì§€ë¥¸ë‹¤.", next: 's10', moral: -30, feedback: "ğŸ“‰ [ë©˜íƒˆ ë¶•ê´´] ê³µí¬ì— ì ì‹ë‹¹í–ˆìŠµë‹ˆë‹¤." }, { text: "ê°€ì¡±ì‚¬ì§„ì„ ë³´ë©° 'ì‚´ì•„ì„œ ëŒì•„ê°„ë‹¤'ê³  ë˜ë‡ë‹¤.", next: 's10', req: 'ê°€ì¡±ì‚¬ì§„', moral: +30, feedback: "âœ¨ [ì•„ì´í…œ ì‚¬ìš©] ê°€ì¡±ì˜ ì–¼êµ´ì´ ê³µí¬ë¥¼ ì´ê²¨ë‚¼ í˜ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤." } ] },
        's10': { text: "[10/20] 1916ë…„ 7ì›”: ì†œ ì „íˆ¬ (ì¤€ë¹„)\nì‚¬ë ¹ë¶€ ëª…ë ¹: 'ì ì§„ì€ ì´ˆí† í™”ë˜ì—ˆë‹¤. ë›°ì§€ ë§ê³  ê±¸ì–´ì„œ ì ë ¹í•˜ë¼.'\në¯¿ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?", choices: [ { text: "ëª…ë ¹ì€ ì ˆëŒ€ì ì´ë‹¤. ì§€ì‹œëŒ€ë¡œ ê±·ëŠ”ë‹¤.", next: 's11', moral: +10, feedback: "ğŸ«¡ [ì¶©ì„±] ëª…ë ¹ì— ë”°ë¥´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. ìµœì•…ì˜ ì˜¤íŒì´ì—ˆìŠµë‹ˆë‹¤." }, { text: "ë¶ˆì•ˆí•˜ë‹¤. ë›¸ ì¤€ë¹„ë¥¼ í•œë‹¤.", next: 's11', hp: +5, moral: -5, feedback: "ğŸ¤” [ì˜ì‹¬] ë‹¹ì‹ ì˜ ì§ê°ì´ ë§ì•˜ìŠµë‹ˆë‹¤." } ] },
        's11': { text: "[11/20] 1916ë…„ 7ì›”: ì†œ ì „íˆ¬ (ëŒê²©)\nì°¸í˜¸ ìœ„ë¡œ ì˜¬ë¼ê°€ìë§ˆì ë…ì¼êµ° ê¸°ê´€ì´ì´ ë¶ˆì„ ë¿œìŠµë‹ˆë‹¤.", choices: [ { text: "ëª…ë ¹ëŒ€ë¡œ ëŒ€ì—´ì„ ìœ ì§€í•˜ë©° ê±·ëŠ”ë‹¤.", next: 's12', damage: 60, feedback: "ğŸ’€ [ì°¸ì‚¬] ì´ë‚  ì˜êµ­êµ° 5ë§Œ 8ì²œ ëª…ì´ ì‚¬ìƒë‹¹í–ˆìŠµë‹ˆë‹¤." }, { text: "ì¦‰ì‹œ í¬íƒ„ êµ¬ë©ì´ë¡œ ë›°ì–´ë“¤ì–´ ìˆ¨ëŠ”ë‹¤.", next: 's12', bonus: 10, feedback: "âœ… [ìƒì¡´] ë¹—ë°œì¹˜ëŠ” ì´íƒ„ ì†ì—ì„œ ì—„íë§Œì´ ì‚´ê¸¸ì…ë‹ˆë‹¤." } ] },
        's12': { text: "[12/20] 1916ë…„: ë¶€ìƒë³‘ì˜ ì ˆê·œ\ní›„í‡´ ì¤‘ ë‹¤ì¹œ ì‹ ë³‘ì´ ì‚´ë ¤ë‹¬ë¼ê³  ì• ì›í•©ë‹ˆë‹¤.\nê·¸ë¥¼ ë¶€ì¶•í•˜ë©´ ë‹¹ì‹ ë„ ìœ„í—˜í•©ë‹ˆë‹¤.", choices: [ { text: "ë¯¸ì•ˆí•˜ë‹¤ê³  ë§í•˜ê³  í˜¼ì ë›´ë‹¤.", next: 's13', moral: -20, humanity: -20, feedback: "ğŸƒâ€â™‚ï¸ [ìƒì¡´] ì‚´ì•˜ì§€ë§Œ ì£„ì±…ê°ì€ í‰ìƒ ë‚¨ì„ ê²ƒì…ë‹ˆë‹¤." }, { text: "ìœ„í—˜ì„ ê°ìˆ˜í•˜ê³  ì—…ê³  ë›´ë‹¤.", next: 's13', hp: -20, humanity: +30, feedback: "ğŸ¤ [ì „ìš°ì• ] ì–´ê¹¨ì— ë¶€ìƒì„ ì…ì—ˆì§€ë§Œ ì „ìš°ë¥¼ êµ¬í–ˆìŠµë‹ˆë‹¤." } ] },
        's13': { text: "[13/20] 1917ë…„: ìˆœë¬´ì˜ ê²¨ìš¸\në³´ê¸‰ì´ ëŠê²¼ìŠµë‹ˆë‹¤. êµ¶ì£¼ë¦° ì†Œë…€ê°€ ë‹¹ì‹ ì„ ì³ë‹¤ë´…ë‹ˆë‹¤.\në‹¹ì‹ ë„ ë°°ê°€ ê³ í”•ë‹ˆë‹¤.", choices: [ { text: "ë‚˜ ë¨¹ì„ ê²ƒë„ ì—†ë‹¤. ì™¸ë©´í•œë‹¤.", next: 's14', humanity: -20, feedback: "ğŸ’” [ë¹„ì •í•¨] ì „ìŸì€ ì‚¬ëŒì„ ì´ê¸°ì ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤." }, { text: "ì•„ê»´ë‘” ì´ˆì½œë¦¿ì„ êº¼ë‚´ ì¤€ë‹¤.", next: 's14', req: 'ì´ˆì½œë¦¿', humanity: +40, moral: +10, feedback: "âœ¨ [ì•„ì´í…œ ì‚¬ìš©] ì†Œë…€ì˜ ë¯¸ì†Œì— ë°°ê³ í””ì„ ì ì‹œ ìŠìŠµë‹ˆë‹¤." } ] },
        's14': { text: "[14/20] 1917ë…„: ì•”ì‹œì¥ ê±°ë˜\në³´ê¸‰ ë¶€ëŒ€ê°€ ê·€í•œ 'í•­ìƒì œ'ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\nëŒ€ê°€ë¥¼ ì§€ë¶ˆí•´ì•¼ í•©ë‹ˆë‹¤.", choices: [ { text: "ê±°ë˜í•  ë¬¼ê±´ì´ ì—†ë‹¤.", next: 's15', feedback: "ğŸš¶ [ë¹ˆì†] ì•„ì‰½ê²Œë„ ê±°ë˜ë¥¼ í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤." }, { text: "[ê¸ˆíšŒì¤‘ì‹œê³„]ë¥¼ ì£¼ê³  ì•½ì„ êµ¬í•œë‹¤.", next: 's15', req: 'ê¸ˆíšŒì¤‘ì‹œê³„', item: 'ì•½', loseItem: 'ê¸ˆíšŒì¤‘ì‹œê³„', feedback: "ğŸ’Š [ê±°ë˜] í›”ì¹œ ì‹œê³„ë¥¼ íŒ”ì•„ ì•½ì„ êµ¬í–ˆìŠµë‹ˆë‹¤." }, { text: "[ì´ˆì½œë¦¿]ì„ ì£¼ê³  ì•½ì„ êµ¬í•œë‹¤.", next: 's15', req: 'ì´ˆì½œë¦¿', item: 'ì•½', loseItem: 'ì´ˆì½œë¦¿', feedback: "ğŸ« [ì •ë‹¹í•œ ê±°ë˜] ì•„ê»´ë‘” ì‹ëŸ‰ìœ¼ë¡œ ì•½ì„ êµ¬í–ˆìŠµë‹ˆë‹¤." } ] },
        's15': { text: "[15/20] 1917ë…„: ì¶”ë½í•œ ì¡°ì¢…ì‚¬\nì¶”ë½í•œ ë…ì¼êµ° ì¡°ì¢…ì‚¬ê°€ ê¸°ì–´ ë‚˜ì˜µë‹ˆë‹¤. ë¶€ìƒë‹¹í–ˆê³  ë¬´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.", choices: [ { text: "ì ì´ë‹¤. ì¦‰ì‹œ ì‚¬ì‚´í•œë‹¤.", next: 's16', humanity: -20, feedback: "ğŸ”« [ì¦ì˜¤] ë¬´ë°©ë¹„ ìƒíƒœì˜ ì ì„ ì‚¬ì‚´í–ˆìŠµë‹ˆë‹¤." }, { text: "í¬ë¡œë¡œ ì¡ëŠ”ë‹¤.", next: 's16', humanity: +20, feedback: "âš–ï¸ [ê¸°ì‚¬ë„] êµ­ì œë²•ì— ë”°ë¼ í¬ë¡œë¡œ ëŒ€ìš°í–ˆìŠµë‹ˆë‹¤." } ] },
        's16': { text: "[16/20] 1917ë…„: ê°•ì²  ê´´ë¬¼ (íƒ±í¬)\nì•„êµ°ì˜ ì‹ ë¬´ê¸° 'íƒ±í¬'ê°€ ë“±ì¥í–ˆìŠµë‹ˆë‹¤.\në³´ë³‘ ì§„ê²© ëª…ë ¹!", choices: [ { text: "ì‚¬ê¸°ë¥¼ ë†’ì´ê¸° ìœ„í•´ íƒ±í¬ë³´ë‹¤ ì•ì¥ì„œì„œ ë‹¬ë¦°ë‹¤.", next: 's17', damage: 40, feedback: "âŒ [ìœ„í—˜] íƒ±í¬ ì•ì€ ì ì˜ í™”ë ¥ì´ ì§‘ì¤‘ë˜ëŠ” ê³³ì…ë‹ˆë‹¤." }, { text: "íƒ±í¬ ë’¤ì— ë°”ì§ ë¶™ì–´ ë”°ë¼ê°„ë‹¤.", next: 's17', bonus: 10, feedback: "âœ… [ì—„í] íƒ±í¬ëŠ” í›Œë¥­í•œ ì´ë™ì‹ ë°©íŒ¨ì…ë‹ˆë‹¤." } ] },
        's17': { text: "[17/20] 1918ë…„ 3ì›”: ë£¨ë´ë„ë¥´í”„ ëŒ€ê³µì„¸\në…ì¼êµ° ì •ì˜ˆ ëŒê²©ëŒ€ê°€ ì•„êµ° ì°¸í˜¸ë¥¼ ëŒíŒŒí–ˆìŠµë‹ˆë‹¤.\nì „ì„ ì´ ë¬´ë„ˆì§€ê³  ìˆìŠµë‹ˆë‹¤!", choices: [ { text: "ë¬´ë„ˆì§„ ì°¸í˜¸ì—ì„œ ëê¹Œì§€ ì‚¬ìˆ˜í•œë‹¤.", next: 's18', damage: 50, feedback: "ğŸ’€ [í”¼í•´] ì ì˜ ì§‘ì¤‘ í¬í™”ì— íœ©ì“¸ë ¤ í° ë¶€ìƒì„ ì…ì—ˆìŠµë‹ˆë‹¤. ë¬´ëª¨í•œ ì €í•­ì´ì—ˆìŠµë‹ˆë‹¤." }, { text: "2ì„ ìœ¼ë¡œ í›„í‡´í•˜ì—¬ ë°©ì–´ì„ ì„ ì¬êµ¬ì¶•í•œë‹¤.", next: 's18', bonus: 10, feedback: "âœ… [ì „ìˆ ì  í›„í‡´] 'ìœ ë™ì  ë°©ì–´' ì „ìˆ ë¡œ ë³‘ë ¥ì„ ë³´ì¡´í–ˆìŠµë‹ˆë‹¤." } ] },
        's18': { text: "[18/20] 1918ë…„ ë´„: ìŠ¤í˜ì¸ ë…ê°\nì „ì—¼ë³‘ì´ ë•ë‹ˆë‹¤. ê³ ì—´ì´ ë‚˜ê³  ê¸°ì¹¨ì´ ë©ˆì¶”ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì•½ì´ ìˆìŠµë‹ˆê¹Œ?", choices: [ { text: "ì•½ì€ ì—†ë‹¤. ì •ì‹ ë ¥ìœ¼ë¡œ ë²„í‹´ë‹¤.", next: 's19', hp: -10, checkStat: 'moral', feedback: "ğŸ¤’ [íˆ¬í˜¼] ê°•ì¸í•œ ì •ì‹ ë ¥ìœ¼ë¡œ ì´ê²¨ëƒˆì§€ë§Œ í›„ìœ ì¦ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤." }, { text: "ì•„ê»´ë‘” 'ì•½'ì„ ë¨¹ëŠ”ë‹¤.", next: 's19', req: 'ì•½', bonus: 30, feedback: "âœ¨ [ì•„ì´í…œ ì‚¬ìš©] ì•½ ë•ë¶„ì— ì”»ì€ ë“¯ì´ ë‚˜ì•˜ìŠµë‹ˆë‹¤!" } ] },
        's19': { text: "[19/20] 1918ë…„: ë°±ì¼ ê³µì„¸\në…ì¼êµ°ì´ ë¬´ë„ˆì§€ê³  ìˆìŠµë‹ˆë‹¤. í•­ë³µí•˜ëŠ” ì†Œë…„ë³‘ê³¼ ë§ˆì£¼ì³¤ìŠµë‹ˆë‹¤.", choices: [ { text: "ë³µìˆ˜ë‹¤. ìœë‹¤.", next: 's20', humanity: -40, feedback: "ğŸ”¥ [ë³µìˆ˜] ë¶„ë…¸ëŠ” í•´ì†Œë˜ì—ˆì§€ë§Œ ì†ì€ í”¼ë¡œ ë¬¼ë“¤ì—ˆìŠµë‹ˆë‹¤." }, { text: "ì´ì„ ê±°ë‘ê³  ë³´ë‚´ì¤€ë‹¤.", next: 's20', humanity: +30, feedback: "ğŸ•Šï¸ [ìš©ì„œ] ë‹¹ì‹ ì€ ëê¹Œì§€ ì¸ê°„ë‹¤ì›€ì„ ì§€ì¼°ìŠµë‹ˆë‹¤." } ] },
        's20': { text: "[20/20] 1918ë…„ 11ì›” 11ì¼: ë§ˆì§€ë§‰ 15ë¶„\n11ì‹œì— íœ´ì „ì…ë‹ˆë‹¤. í˜„ì¬ 10ì‹œ 45ë¶„.\nì†ŒëŒ€ì¥ì´ ë§ˆì§€ë§‰ ëŒê²©ì„ ëª…ë ¹í•©ë‹ˆë‹¤.", choices: [ { text: "ëª…ë ¹ì— ë”°ë¼ ë§ˆì§€ë§‰ ëŒê²©ì„ ê°í–‰í•œë‹¤.", next: 'ending', damage: 100, feedback: "â˜ ï¸ [ë¹„ê·¹] íœ´ì „ 2ë¶„ ì „ ì „ì‚¬í–ˆìŠµë‹ˆë‹¤. 1ì°¨ ëŒ€ì „ì˜ ë§ˆì§€ë§‰ ì „ì‚¬ìì…ë‹ˆë‹¤." }, { text: "ì²™ë§Œ í•˜ê³  í¬íƒ„ êµ¬ë©ì´ì— ì—ë“œë¦°ë‹¤.", next: 'ending', bonus: 10, feedback: "ğŸ”” [ì¢…ì „] 11ì‹œ ì •ê°, ë‚˜íŒ” ì†Œë¦¬ê°€ ìš¸ë¦½ë‹ˆë‹¤. ì‚´ì•˜ìŠµë‹ˆë‹¤." } ] },
        'ending': {}
    };

    function renderScene() {
        if (state.hp <= 0) { showEnding(true); return; }
        if (state.scene === 'ending') { showEnding(false); return; }
        checkRandomDrop(state.scene);
        const data = scenarios[state.scene];
        document.getElementById('scenario-text').innerText = data.text;
        
        let currentStageNum = 0;
        let dayText = "ì…ëŒ€ì¼";
        if(state.scene !== 'intro') {
            currentStageNum = parseInt(state.scene.replace('s', ''));
            dayText = `Day ${currentStageNum}`;
        }
        state.step = currentStageNum;
        document.getElementById('stage-text').innerText = dayText;
        document.getElementById('progress-bar').style.width = `${(currentStageNum / TOTAL_STAGES) * 100}%`;

        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '';
        document.getElementById('feedback-area').style.display = 'none';

        data.choices.forEach(choice => {
            if (choice.req && !state.inventory.includes(choice.req)) return;
            const btn = document.createElement('button');
            btn.classList.add('choice-btn');
            
            if (state.difficulty === 'hard') {
                btn.classList.add('hard-mode-btn');
                btn.innerText = choice.text;
            } else {
                if (choice.item && choice.loseItem) { btn.classList.add('trade-btn'); btn.innerHTML = `${choice.text} <span class="tag tag-trade"> ê±°ë˜</span>`; }
                else if (choice.req) { btn.classList.add('use-item-btn'); btn.innerHTML = `${choice.text} <span class="tag tag-use"> ì‚¬ìš©</span>`; }
                else if (choice.item) { btn.classList.add('get-item-btn'); btn.innerHTML = `${choice.text} <span class="tag tag-get"> íšë“</span>`; }
                else { btn.innerText = choice.text; }
            }
            btn.onclick = () => handleChoice(choice);
            choicesDiv.appendChild(btn);
        });
        updateUI();
    }

    function handleChoice(choice) {
        if (choice.item) state.inventory.push(choice.item);
        if (choice.loseItem) {
            const idx = state.inventory.indexOf(choice.loseItem);
            if (idx > -1) state.inventory.splice(idx, 1);
        }
        
        let damage = choice.damage || 0;
        let feedback = choice.feedback;

        if (choice.checkStat === 'moral') {
            if (state.moral >= 70) {
                damage = 15; feedback += " ê°•ì¸í•œ ì •ì‹ ë ¥ìœ¼ë¡œ ì´ê²¨ëƒˆìŠµë‹ˆë‹¤.";
            } else {
                damage = 50; feedback += " ì •ì‹ ë ¥ì´ ì•½í•´ ë³‘ë§ˆë¥¼ ì´ê¸°ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            }
        }

        let dmgMult = (state.difficulty === 'hard') ? 1.5 : 1.0;
        let healMult = (state.difficulty === 'hard') ? 0.5 : 1.0;

        if (damage > 0) state.hp -= Math.floor(damage * dmgMult);
        if (choice.bonus) state.hp += Math.floor(choice.bonus * healMult);
        if (choice.hp) state.hp += Math.floor(choice.hp * ((choice.hp > 0) ? healMult : dmgMult));
        if (choice.moral) state.moral += Math.floor(choice.moral * ((choice.moral > 0) ? healMult : dmgMult));
        if (choice.humanity) state.humanity += choice.humanity;

        state.hp = Math.min(100, Math.max(0, state.hp));
        state.moral = Math.min(100, Math.max(0, state.moral));
        state.humanity = Math.min(100, Math.max(0, state.humanity));

        state.scene = choice.next;

        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '';
        const fbArea = document.getElementById('feedback-area');
        fbArea.innerHTML = `<span class="fact-title">ğŸ“ ì¢…êµ° ì¼ì§€</span>${feedback}`;
        fbArea.style.display = 'block';

        const nextBtn = document.createElement('button');
        nextBtn.classList.add('choice-btn', 'next-btn'); 
        nextBtn.innerText = "ë‹¤ìŒ ì¥ìœ¼ë¡œ ë„˜ê¸°ê¸° â–¶";
        nextBtn.onclick = () => renderScene();
        choicesDiv.appendChild(nextBtn);
        updateUI();
    }

    function updateUI() {
        const grid = document.getElementById('inv-grid');
        grid.innerHTML = '';
        for (let i = 0; i < 4; i++) {
            const slot = document.createElement('div');
            if (i < state.inventory.length) {
                const itemName = state.inventory[i];
                const item = itemData[itemName] || { icon: 'ğŸ“¦', desc: itemName };
                slot.className = 'inv-slot';
                slot.innerHTML = `${item.icon}<span class="tooltip">${item.desc}</span>`;
            } else { slot.className = 'inv-slot empty'; slot.innerText = '+'; }
            grid.appendChild(slot);
        }
        
        const hpBar = document.getElementById('hp-bar');
        const moralBar = document.getElementById('moral-bar');
        const humanBar = document.getElementById('human-bar');
        
        hpBar.style.width = state.hp + '%';
        moralBar.style.width = state.moral + '%';
        humanBar.style.width = state.humanity + '%';

        if (state.difficulty === 'hard') {
            hpBar.className = "stat-bar-fill blind-bar";
            moralBar.className = "stat-bar-fill blind-bar";
            humanBar.className = "stat-bar-fill blind-bar";
            
            document.getElementById('hp-text').innerText = state.hp > 70 ? "ì–‘í˜¸" : "ìœ„í—˜";
            document.getElementById('moral-text').innerText = state.moral > 70 ? "ì•ˆì •" : "ë¶ˆì•ˆ";
            
            let hText = "ë³´í†µ";
            if(state.humanity >= 80) hText = "ìˆ­ê³ ";
            else if(state.humanity <= 30) hText = "ë¹„ì •";
            document.getElementById('human-text').innerText = hText;
        } else {
            hpBar.className = "stat-bar-fill";
            moralBar.className = "stat-bar-fill";
            humanBar.className = "stat-bar-fill";
            
            document.getElementById('hp-text').innerText = state.hp;
            document.getElementById('moral-text').innerText = state.moral;
            document.getElementById('human-text').innerText = state.humanity;
        }
        
        if(state.hp < 30) document.getElementById('hp-text').classList.add('danger');
        else document.getElementById('hp-text').classList.remove('danger');
    }

    function typeWriter(text, elementId, speed = 30) {
        const target = document.getElementById(elementId);
        target.innerHTML = '';
        target.classList.add('typewriter-cursor');
        let i = 0;
        function type() {
            if (i < text.length) {
                if (text.charAt(i) === '<') {
                    let tag = '';
                    while (text.charAt(i) !== '>') { tag += text.charAt(i); i++; }
                    tag += '>'; i++; target.innerHTML += tag;
                } else { target.innerHTML += text.charAt(i); i++; }
                setTimeout(type, speed);
            } else { target.classList.remove('typewriter-cursor'); }
        }
        type();
    }

    function showEnding(isDead) {
        document.getElementById('choices').innerHTML = '<button class="choice-btn next-btn" onclick="location.reload()">ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°</button>';
        document.getElementById('feedback-area').style.display = 'none';
        
        let title = isDead ? "ì „ì‚¬ í†µì§€ì„œ" : "ìƒì¡´ìì˜ í¸ì§€";
        let content = "";
        
        if(isDead) {
            content = "ê·€í•˜ì˜ ê°€ì¡±ì€ 1ì°¨ ì„¸ê³„ëŒ€ì „ì˜ ì „ì¥ì—ì„œ ëª…ì˜ˆë¡­ê²Œ ì „ì‚¬í•˜ì˜€ìŠµë‹ˆë‹¤.<br>ê·¸ì˜ í¬ìƒì€ ì—­ì‚¬ì— ì˜ì›íˆ ê¸°ë¡ë  ê²ƒì…ë‹ˆë‹¤.";
        } else {
            content = "1918ë…„ 11ì›” 11ì¼, ì „ìŸì´ ëë‚¬ìŠµë‹ˆë‹¤.<br>4ë…„ì˜ ì§€ì˜¥ì—ì„œ ì‚´ì•„ë‚¨ì•„ ê³ í–¥ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.<br><br>";
            if(state.humanity >= 80) content += "ì €ëŠ” ì „ìŸí„°ì—ì„œë„ ì¸ê°„ì„±ì„ ìƒì§€ ì•Šì€ <span class='highlight-text'>ì„±ì</span>ì˜€ìŠµë‹ˆë‹¤.<br>";
            else if(state.moral <= 30) content += "ëª¸ì€ ëŒì•„ì™”ì§€ë§Œ, ì œ ì˜í˜¼ì€ <span class='highlight-text'>ë¶€ì„œì¡ŒìŠµë‹ˆë‹¤</span>.<br>";
            else content += "ì €ëŠ” ì—­ì‚¬ì˜ ì‚°ì¦ì¸, <span class='highlight-text'>ë² í…Œë‘</span>ì…ë‹ˆë‹¤.<br>";
            
            if(state.inventory.includes('ê°€ì¡±ì‚¬ì§„')) content += "<br>í’ˆì†ì˜ ê°€ì¡±ì‚¬ì§„ì„ êº¼ë‚´ ì…ì„ ë§ì¶¥ë‹ˆë‹¤.";
            if(state.inventory.includes('ê¸ˆíšŒì¤‘ì‹œê³„')) content += "<br>ì£¼ë¨¸ë‹ˆ ì† í›”ì¹œ ì‹œê³„ê°€ ë¬´ê²ê²Œ ëŠê»´ì§‘ë‹ˆë‹¤.";
        }
        
        document.getElementById('scenario-text').innerHTML = `<h2 style="color:#c5a065;">${title}</h2><div id="ending-typewriter" style="line-height:2.0; font-size:1.1em;"></div>`;
        typeWriter(content, 'ending-typewriter', 40);
    }
</script>

</body>
</html>
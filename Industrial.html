<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Industrial Revolution: Final Fixed</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Cinzel:wght@700&family=Nanum+Myeongjo:wght@400;700;800&display=swap');

        :root {
            --bg-desk: #1a1a1a;
            --paper-color: #f3e5ca;
            --machine-bg: #3e2723;
            --policy-bg: #263238;
            --ink: #2b2b2b;
            --danger-glow: rgba(183, 28, 28, 0);
        }

        body {
            background-color: var(--bg-desk);
            color: var(--ink);
            font-family: 'Nanum Myeongjo', serif;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* ë°°ê²½ íš¨ê³¼ */
        #smog-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(20, 20, 20, 0); pointer-events: none; z-index: 40;
            transition: background 2s ease; mix-blend-mode: multiply;
        }
        #anger-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 0 0 var(--danger-glow); pointer-events: none; z-index: 45;
            transition: box-shadow 1s ease; mix-blend-mode: overlay;
        }
        .critical-warning { animation: pulseRed 1s infinite alternate; }

        #desk-container {
            width: 1150px;
            height: 780px;
            display: flex;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            z-index: 50;
        }

        /* --- [ì™¼ìª½] ì‹ ë¬¸ íŒ¨ë„ --- */
        .paper-panel {
            flex: 0.8;
            background: var(--paper-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            transform: rotate(-0.5deg);
        }
        .paper-header { text-align: center; border-bottom: 3px double #3e2723; padding-bottom: 10px; margin-bottom: 15px; }
        .paper-title { font-family: 'Cinzel', serif; font-size: 1.8em; font-weight: 900; color: #3e2723; }
        
        .year-badge {
            background: #3e2723; color: #fff; padding: 4px 10px; border-radius: 4px;
            font-weight: bold; font-family: 'Courier New', monospace; font-size: 1.2em;
            display: inline-block; margin-top: 5px;
        }

        .status-note {
            background: rgba(255,255,255,0.6); border: 2px solid #5d4037;
            padding: 15px; margin-bottom: 15px; min-height: 140px;
        }
        .stat-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; font-weight: bold; font-size: 0.95em; }
        .big-val { font-size: 1.3em; font-family: 'Courier New', monospace; font-weight: 900; }
        
        .hidden-stat { display: none; }
        .revealed-stat { display: flex; animation: fadeIn 1s ease-in; color: #b71c1c; border-top: 1px dashed #8d6e63; padding-top: 5px; margin-top: 5px; }

        .news-archive {
            flex: 1; border-top: 2px solid #5d4037; border-bottom: 2px solid #5d4037;
            padding: 10px; overflow-y: auto; background: rgba(240, 230, 210, 0.5); font-size: 0.9em;
        }
        .news-archive::-webkit-scrollbar { width: 6px; }
        .news-archive::-webkit-scrollbar-thumb { background: #8d6e63; border-radius: 3px; }

        .news-item { margin-bottom: 8px; border-bottom: 1px dashed #aaa; padding-bottom: 4px; }

        #alert-badge {
            margin-top: 10px; background: #b71c1c; color: #fff; padding: 15px; border-radius: 4px;
            font-weight: bold; text-align: center; cursor: pointer; border: 2px solid #fff;
            animation: bounce 1s infinite; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* --- [ì˜¤ë¥¸ìª½] ì»¨íŠ¸ë¡¤ íŒ¨ë„ --- */
        .control-panel {
            flex: 1.4;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* 1. ê³µì¥ & ê¸°ìˆ  (ê°ˆìƒ‰) */
        .tech-section {
            flex: 1.2;
            background: var(--machine-bg);
            border-radius: 12px;
            padding: 15px;
            border: 4px solid #281813;
            box-shadow: inset 0 0 20px #000;
            display: flex;
            flex-direction: column;
            color: #d7ccc8;
        }

        /* 2. ì •ì±… & ê´€ë¦¬ (ë‚¨ìƒ‰) */
        .policy-section {
            flex: 1;
            background: var(--policy-bg);
            border-radius: 12px;
            padding: 15px;
            border: 4px solid #102027;
            box-shadow: inset 0 0 20px #000;
            display: flex;
            flex-direction: column;
            color: #cfd8dc;
        }

        .section-header {
            font-family: 'Cinzel', serif; font-weight: bold; font-size: 1.1em;
            border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 8px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .prod-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: stretch; }
        
        .gauge-box {
            flex: 1; background: #212121; border: 1px solid #5d4037; border-radius: 6px;
            padding: 10px; text-align: center; display: flex; flex-direction: column; justify-content: center;
        }
        .gauge-val { color: #ffd700; font-size: 1.2em; font-weight: bold; }
        .gauge-label { font-size: 0.7em; color: #aaa; }

        #work-btn {
            flex: 1.5; background: radial-gradient(#6d4c41, #3e2723);
            border-radius: 8px; border: none; border-bottom: 5px solid #261612;
            color: #fff; cursor: pointer; padding: 10px;
            position: relative; transition: transform 0.1s;
        }
        #work-btn:active { transform: translateY(4px); border-bottom: 2px solid #261612; }
        #work-btn:disabled { background: #444; border-bottom: 5px solid #222; cursor: not-allowed; }
        .btn-text { font-family: 'Black Ops One'; font-size: 1.2em; display: block; }

        .sabotage-tape {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            color: #ff3d00; font-weight: bold; font-size: 1.5em; 
            display: none; align-items: center; justify-content: center;
            flex-direction: column;
            z-index: 10; border-radius: 8px;
            border: 2px dashed #ff3d00;
        }

        .scroll-list { flex: 1; overflow-y: auto; padding-right: 5px; }
        .scroll-list::-webkit-scrollbar { width: 6px; }
        .scroll-list::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card-base {
            border-radius: 4px; padding: 10px; margin-bottom: 8px;
            cursor: pointer; border: 1px solid #a1887f;
            display: flex; justify-content: space-between; align-items: center;
            transition: all 0.2s; position: relative;
        }
        
        .tech-card { background: #d7ccc8; color: #3e2723; }
        .policy-card { background: #cfd8dc; color: #263238; border: 1px solid #607d8b; border-left: 5px solid #455a64; }

        .card-base:hover { transform: translateX(3px); background: #fff; }
        .card-base.disabled { opacity: 0.5; filter: grayscale(1); }
        .card-base.locked { background: #616161; color: #9e9e9e; pointer-events: none; justify-content: center; font-style: italic; }
        
        .card-base.purchased { 
            background: #3e2723; color: #8d6e63; opacity: 0.4; pointer-events: none; border-color: #2e1c19;
        }
        .policy-card.active { 
            background: #263238; color: #546e7a; border-left-color: #00bcd4; opacity: 0.5; pointer-events: none; 
        }

        .card-base.affordable {
            background: #fff8e1; border-color: #ffd700;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
            z-index: 5;
        }

        .card-info h4 { margin: 0 0 2px 0; font-size: 0.95em; }
        .card-info p { margin: 0; font-size: 0.75em; opacity: 0.9; }
        .card-cost { font-weight: bold; padding: 2px 6px; border-radius: 3px; font-size: 0.85em; }
        
        .tech-cost-badge { background: #3e2723; color: #ffd700; }
        .policy-cost-badge { background: #1a237e; color: #fff; }

        /* ëª¨ë‹¬ & ì• ë‹ˆë©”ì´ì…˜ */
        #news-modal {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85); z-index: 200;
            display: none; justify-content: center; align-items: center;
        }
        #extra-paper {
            width: 550px; padding: 40px; background: #fffdf0;
            transform: rotate(1deg); box-shadow: 0 0 50px rgba(0,0,0,0.8);
            text-align: center; border: 1px solid #aaa; color: #333;
        }
        .paper-headline { 
            font-family: 'Cinzel', serif; font-size: 2.2em; font-weight: 900; 
            border-bottom: 3px double #000; margin-bottom: 20px; padding-bottom: 10px;
            color: #1a1a1a; letter-spacing: -1px;
        }
        .dilemma-btn-group { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
        .dilemma-btn {
            padding: 15px 20px; border: 2px solid #333; cursor: pointer; font-weight: bold; width: 45%;
            transition: all 0.2s;
        }
        .btn-opt1 { background: #d32f2f; color: white; border-color: #b71c1c; } 
        .btn-opt1:hover { background: #b71c1c; }
        .btn-opt2 { background: #1976d2; color: white; border-color: #0d47a1; } 
        .btn-opt2:hover { background: #0d47a1; }

        .float-money {
            position: absolute; color: #ffd700; font-weight: 900; font-size: 1.5em;
            pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 100; text-shadow: 2px 2px 0 #000;
        }

        /* ì—”ë”© í™”ë©´ */
        #ending-screen {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: #1a1a1a; z-index: 300;
            display: none; justify-content: center; align-items: center;
        }
        #ending-letter {
            width: 600px; padding: 50px; background: #fdf5e6;
            box-shadow: 0 0 100px rgba(0,0,0,0.9);
            font-family: 'Nanum Myeongjo', serif; color: #2b2b2b;
            position: relative; line-height: 1.8;
        }
        .letter-title { font-size: 2em; font-weight: bold; margin-bottom: 30px; text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .letter-body { font-size: 1.1em; margin-bottom: 40px; text-align: justify; }
        .letter-footer { text-align: right; font-style: italic; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 0% { color: inherit; } 50% { color: red; } 100% { color: inherit; } }
        @keyframes pulseRed { 0% { box-shadow: inset 0 0 50px rgba(255,0,0,0.2); } 100% { box-shadow: inset 0 0 100px rgba(255,0,0,0.6); } }

    </style>
</head>
<body>

<div id="smog-layer"></div>
<div id="anger-layer"></div>

<div id="desk-container">
    
    <div class="paper-panel">
        <div class="paper-header">
            <div class="paper-title">THE DAILY TIMES</div>
            <div class="year-badge"><span id="year">1760</span>ë…„ <span id="month">1</span>ì›”</div>
        </div>

        <div class="status-note">
            <div class="stat-row">
                <span>ìë³¸ê¸ˆ (Capital)</span>
                <span class="big-val" style="color:#2e7d32;">Â£<span id="money">0</span></span>
            </div>
            <div class="stat-row">
                <span>ìˆ˜ìµ (Income)</span>
                <span>+Â£<span id="income">0</span> / sec</span>
            </div>
            <div class="stat-row">
                <span>ì¬ê³  (Inventory)</span>
                <span id="market-status" style="color:green;">ì ì • (Stable)</span>
            </div>
            
            <div id="stat-pollution" class="stat-row hidden-stat">
                <span>ğŸ­ í™˜ê²½ ì˜¤ì—¼</span>
                <span><span id="pollution">0</span>%</span>
            </div>
            <div id="stat-anger" class="stat-row hidden-stat">
                <span>ğŸ˜¡ ë…¸ë™ ë¶ˆë§Œ</span>
                <span><span id="anger">0</span>%</span>
            </div>
        </div>

        <div class="news-archive" id="news-archive"></div>
        <div id="alert-badge" onclick="openModal()">ğŸš¨ ì†ë³´ (BREAKING NEWS)</div>
        <div style="margin-top:auto; text-align:center; font-size:0.7em; color:#888; opacity:0.6;">Developed by Son Seoyul</div>
    </div>

    <div class="control-panel">
        
        <div class="tech-section">
            <div class="section-header">
                <span>ğŸ­ ê¸°ìˆ  ì—°êµ¬ì†Œ (Industrial Tech)</span>
                <span style="font-size:0.7em; color:#ffd700;">PROFIT & GROWTH</span>
            </div>

            <div class="prod-row">
                <div class="gauge-box">
                    <div class="gauge-label">CURRENT PRODUCT</div>
                    <div class="gauge-val" id="prod-name">ëª¨ì§ë¬¼</div>
                </div>
                <button id="work-btn" onclick="manualWork(event)">
                    <span class="btn-text">ìƒì‚° (WORK)</span>
                    <div style="font-size:0.7em; opacity:0.8;">Click: +Â£<span id="click-power">1</span></div>
                    <div class="sabotage-tape" id="sabotage-tape">
                        <div>ğŸš§ STRIKE ğŸš§</div>
                        <div id="sabotage-timer" style="font-size:0.8em; margin-top:5px;">8s...</div>
                    </div>
                </button>
            </div>

            <div class="scroll-list" id="tech-list"></div>
        </div>

        <div class="policy-section">
            <div class="section-header">
                <span>âš–ï¸ ê²½ì˜ ê´€ë¦¬ì‹¤ (Management)</span>
                <span style="font-size:0.7em; color:#90a4ae;">ORDER & WELFARE</span>
            </div>
            <div class="scroll-list" id="policy-list"></div>
        </div>

    </div>
</div>

<div id="news-modal">
    <div id="extra-paper">
        <div class="extra-badge">BREAKING NEWS</div>
        <div class="paper-headline" id="modal-title">TITLE</div>
        <p style="font-size:1.1em; line-height:1.6;" id="modal-body">Text...</p>
        
        <div id="modal-confirm-area" style="display:block;">
            <div style="background:#eee; padding:10px; font-weight:bold; color:#b71c1c; margin:20px 0;" id="modal-effect">Effect</div>
            <button onclick="closeModal()" style="padding:10px 40px; background:#333; color:white; border:none; cursor:pointer; font-size:1.1em;">í™•ì¸ (CONFIRM)</button>
        </div>

        <div id="modal-choice-area" class="dilemma-btn-group" style="display:none;">
            <button class="dilemma-btn btn-opt1" onclick="resolveDilemma(0)">ì„ íƒ 1</button>
            <button class="dilemma-btn btn-opt2" onclick="resolveDilemma(1)">ì„ íƒ 2</button>
        </div>
    </div>
</div>

<div id="ending-screen">
    <div id="ending-letter">
        <div class="letter-title" id="end-title">TITLE</div>
        <div class="letter-body" id="end-body">
            Body...
        </div>
        <div class="letter-footer">
            1930ë…„ ëŸ°ë˜ì—ì„œ,<br>
            ì–´ëŠ ëŠ™ì€ ê³µì¥ì£¼ì˜ íšŒê³ ë¡.
        </div>
        <button onclick="location.reload()" style="margin-top:30px; padding:10px 30px; background:#2b2b2b; color:white; border:none; cursor:pointer; width:100%;">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
</div>

<script>
    // --- ê²Œì„ ìƒíƒœ ---
    window.STATE = {
        money: 0,
        income: 0,
        clickPower: 1,
        
        pollution: 0, 
        anger: 0,
        angerRate: 0.05,
        bubble: 0,    
        
        statsRevealed: false,
        isPaused: false, 
        isSabotaged: false,

        productStage: 0,
        purchasedTechs: [],
        purchasedPolicies: [],
        
        pendingEvent: null, 
        eventCooldown: 0,
        
        year: 1760,
        month: 1,
        
        lastEventId: null, 
        history: [] // ë°œìƒí•œ 1íšŒì„± ì´ë²¤íŠ¸ ID
    };

    const PRODUCTS = [ "ëª¨ì§ë¬¼ (WOOLEN CLOTH)", "ë©´ì§ë¬¼ (COTTON)", "ì² ê¸° (IRON TOOLS)", "ê°•ì²  ë ˆì¼ (STEEL)", "êµ°ìˆ˜í’ˆ (MUNITIONS)" ];

    // [ê¸°ìˆ  ë°ì´í„°]
    const TECHS = [
        { id: 'shuttle', name: 'ë‚˜ëŠ” ë¶ (Flying Shuttle)', cost: 50, oneTime: true, type: 'click', val: 3, desc: 'ì§ì¡° ì†ë„ í–¥ìƒ', req: null },
        { id: 'jenny', name: 'ì œë‹ˆ ë°©ì ê¸°', cost: 200, oneTime: true, type: 'stage', stage: 1, income: 10, desc: '[ìƒì‚°í’ˆ ë³€ê²½] ë©´ì§ë¬¼ ê³µì¥ ì „í™˜', req: 'shuttle', anger: 5 },
        { id: 'expand_looms', name: 'ì§ê¸° ì¶”ê°€ ì„¤ì¹˜', cost: 100, oneTime: false, type: 'auto', val: 5, desc: 'ìƒì‚° ë¼ì¸ í™•ì¥ (+ìˆ˜ìµ)', req: 'jenny' },
        { id: 'steam', name: 'ì™€íŠ¸ ì¦ê¸° ê¸°ê´€', cost: 800, oneTime: true, type: 'stage', stage: 2, income: 40, desc: '[ìƒì‚°í’ˆ ë³€ê²½] ì¦ê¸° ë™ë ¥ (ì˜¤ì—¼ ì‹œì‘)', pollution: 10, revealStats: true, req: 'jenny', anger: 10 },
        { id: 'child_labor', name: 'ì•„ë™ ë…¸ë™ í™•ëŒ€', cost: 300, oneTime: false, type: 'auto', val: 15, desc: 'ê°’ì‹¼ ë…¸ë™ë ¥ ê³ ìš© (ìˆ˜ìµ++, ë¶ˆë§Œ++)', riskAnger: 15, req: 'steam' },
        { id: 'coke', name: 'ì½”í¬ìŠ¤ ì œì² ë²•', cost: 2500, oneTime: true, type: 'stage', stage: 3, clickVal: 50, desc: '[ìƒì‚°í’ˆ ë³€ê²½] ê°•ì²  ìƒì‚° (ì˜¤ì—¼++)', pollution: 15, req: 'steam' },
        { id: 'railway', name: 'ì² ë„ë§ ë¶€ì„¤', cost: 5000, oneTime: false, type: 'auto', val: 150, desc: 'ì „êµ­ ë¬¼ë¥˜ ì—°ê²° (ì˜¤ì—¼++, ì¬ê³ ++)', pollution: 10, bubble: 10, req: 'coke' },
        { id: 'bessemer', name: 'ë² ì„¸ë¨¸ ì œê°•ë²•', cost: 15000, oneTime: true, type: 'stage', stage: 4, income: 600, desc: '[ìƒì‚°í’ˆ ë³€ê²½] ëŒ€ëŸ‰ ìƒì‚° ì²´ì œ', bubble: 30, pollution: 30, req: 'coke' }
    ];

    // [ì •ì±… ë°ì´í„°]
    const POLICIES = [
        { 
            id: 'police', name: 'ì‚¬ì„¤ ê²½ë¹„ëŒ€ ê³ ìš©', cost: 500, oneTime: false, 
            type: 'suppress', val: -30, 
            desc: '[ê°•ê²½ì±…] ì‹œìœ„ ê°•ì œ ì§„ì••. (ë¹„ìš© ì €ë ´ / ë¶€ì‘ìš©: ë¶ˆë§Œ ëˆ„ì  ì†ë„ ì¦ê°€)', 
            sideEffect: 0.05, 
            req: 'steam' 
        },
        { 
            id: 'church', name: 'ì£¼ì¼ í•™êµ ì„¤ë¦½', cost: 1200, oneTime: false, 
            type: 'soothe', val: -10, 
            desc: '[ìœ í™”ì±…] ë…¸ë™ì êµìœ¡ ë° ë³µì§€. (ë¹„ìš© ê³ ê°€ / íš¨ê³¼: ë¶ˆë§Œ ëˆ„ì  ì†ë„ ê°ì†Œ)', 
            sideEffect: -0.02, 
            req: 'steam' 
        },
        { id: 'welfare', name: 'ê³µì¥ë²• ì¤€ìˆ˜', cost: 2000, oneTime: true, type: 'reform', val: -10, desc: '[ê°œí˜] ë…¸ë™ ì‹œê°„ ë‹¨ì¶• (ë¶ˆë§Œ--, ìˆ˜ìµ-)', incomeNerf: 0.9, req: 'coke' },
        { id: 'union', name: 'ë…¸ë™ì¡°í•© ì¸ì •', cost: 5000, oneTime: true, type: 'reform', val: -30, desc: '[ê°œí˜] ë‹¨ì²´ êµì„­ê¶Œ ë³´ì¥ (ë¶ˆë§Œ ì§€ì† ê°ì†Œ)', incomeNerf: 0.8, autoSoothe: true, req: 'railway' },
        
        {
            id: 'dumping', name: 'ğŸ“‰ ì¬ê³  í—ê°’ ì²˜ë¶„', cost: 0, oneTime: false,
            type: 'emergency', val: 0,
            desc: 'ì†í•´ë¥¼ ë³´ê³  ì°½ê³ ë¥¼ ë¹„ì›ë‹ˆë‹¤. (ìë³¸ê¸ˆ -50%, ì¬ê³  -30%)',
            req: 'steam', 
            isEmergency: true
        }
    ];

    // [ì´ë²¤íŠ¸ í’€]
    const EVENT_POOL = [
        // 1. ë‹¨ìˆœ ì‚¬ê±´ (ìì£¼ ëœ¸)
        { id: 'accident', prob: 0.2, cond: (s) => s.productStage >= 1, title: 'ê³µì¥ ì•ˆì „ ì‚¬ê³ ', desc: 'ê¸°ê³„ ê³¼ì—´ë¡œ ê³ ì¥ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', effectStr: 'ìˆ˜ë¦¬ë¹„ -Â£200', action: () => addMoney(-200) },
        
        // 2. ë”œë ˆë§ˆ
        { 
            id: 'enclosure', oneTime: true, prob: 0.8, cond: (s) => s.year >= 1765, 
            title: 'ì¸í´ë¡œì € ìš´ë™', 
            desc: 'ë†ì§€ì—ì„œ ì«“ê²¨ë‚œ ë†ë¯¼ë“¤ì´ ë„ì‹œë¡œ ëª°ë ¤ë“¤ì–´ ë¹ˆë¯¼ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.',
            isDilemma: true,
            choices: [
                { text: "í—ê°’ì— ê³ ìš©í•œë‹¤ (ìˆ˜ìµâ†‘, ë¶ˆë§Œâ†‘)", action: () => { window.STATE.income+=10; window.STATE.anger+=15; addNews("ê°’ì‹¼ ë…¸ë™ë ¥ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤."); } },
                { text: "ë¹ˆë¯¼ êµ¬ì œì„¸ ë‚©ë¶€ (ë¹„ìš© ë°œìƒ)", action: () => { addMoney(-200); addNews("ìµœì†Œí•œì˜ êµ¬í˜¸ë¥¼ ì œê³µí–ˆìŠµë‹ˆë‹¤."); } }
            ]
        },
        {
            id: 'phossy_jaw', oneTime: true, prob: 0.6, cond: (s) => s.productStage >= 2,
            title: 'ë°±ë¦° ì¤‘ë… (Phossy Jaw)',
            desc: 'ì„±ëƒ¥ ê³µì¥ ì—¬ê³µë“¤ì˜ í„± ë¼ˆê°€ ì©ì–´ë“¤ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤. ë°±ë¦° ì‚¬ìš©ì„ ì¤‘ë‹¨í•˜ë©´ ë¹„ìš©ì´ ë“­ë‹ˆë‹¤.',
            isDilemma: true,
            choices: [
                { text: "ê³„ì† ì‚¬ìš© (ìˆ˜ìµ ìœ ì§€, ì˜¤ì—¼â†‘)", action: () => { window.STATE.pollution += 10; addNews("ì´ìœ¤ì„ ìœ„í•´ í¬ìƒì„ ê°ìˆ˜í–ˆìŠµë‹ˆë‹¤."); } },
                { text: "ë°±ë¦° ê¸ˆì§€ (ë¹„ìš© -Â£1000, ì˜¤ì—¼â†“)", action: () => { addMoney(-1000); window.STATE.pollution -= 5; addNews("ì•ˆì „í•œ ì„±ëƒ¥ì„ ìƒì‚°í•©ë‹ˆë‹¤."); } }
            ]
        },
        {
            id: 'stink', oneTime: true, prob: 0.6, cond: (s) => s.pollution > 50,
            title: 'ëŒ€ì•…ì·¨ (Great Stink)',
            desc: 'í…œìŠ¤ê°•ì˜ ì•…ì·¨ë¡œ ì¸í•´ ë„ì‹œê°€ ë§ˆë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ìˆ˜ë„ë¥¼ ì •ë¹„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
            isDilemma: true,
            choices: [
                { text: "ì„íšŒë§Œ ë¿Œë¦°ë‹¤ (ë¹„ìš© ì €ë ´, íš¨ê³¼ ë¯¸ë¯¸)", action: () => { addMoney(-200); window.STATE.pollution -= 2; addNews("ì„ì‹œë°©í¸ìœ¼ë¡œ ì•…ì·¨ë¥¼ ë®ì—ˆìŠµë‹ˆë‹¤."); } },
                { text: "í•˜ìˆ˜ë„ ê±´ì„¤ (ë¹„ìš© -Â£3000, ì˜¤ì—¼ ëŒ€í­â†“)", action: () => { addMoney(-3000); window.STATE.pollution -= 20; addNews("ê·¼ëŒ€ì  í•˜ìˆ˜ë„ ì‹œìŠ¤í…œì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤."); } }
            ]
        },

        // ì—­ì‚¬ì  ì‚¬ê±´
        { id: 'napoleon', oneTime: true, prob: 0.3, cond: (s) => s.productStage >= 1 && s.year < 1815, title: 'ë‚˜í´ë ˆì˜¹ ì „ìŸ', desc: 'êµ°ìˆ˜í’ˆ ìˆ˜ìš” ê¸‰ì¦! ì¬ê³ ê°€ ë¹ ë¥´ê²Œ ì†Œì§„ë©ë‹ˆë‹¤.', effectStr: 'ì¬ê³  ê°ì†Œ(ê±°í’ˆâ†“), ìë³¸ê¸ˆ ì¦ê°€', action: () => { addMoney(1500); window.STATE.bubble = Math.max(0, window.STATE.bubble - 20); } },
        { id: 'railway_mania', oneTime: true, prob: 0.3, cond: (s) => s.purchasedTechs.includes('railway'), title: 'ì² ë„ ì—´í’ (Railway Mania)', desc: 'ì „êµ­ì´ ì² ë„ íˆ¬ì ê´‘í’ì— íœ©ì‹¸ì˜€ìŠµë‹ˆë‹¤. íˆ¬ììê°€ ëª°ë¦½ë‹ˆë‹¤.', effectStr: 'ì¬ê³  ê¸‰ì¦(ìœ„í—˜!), ìë³¸ê¸ˆ ëŒ€í­ ì¦ê°€', action: () => { window.STATE.bubble += 30; addMoney(5000); } },
        { id: 'chartism', oneTime: true, prob: 0.3, cond: (s) => s.anger > 40, title: 'ì¸ë¯¼ í—Œì¥ (Chartism)', desc: 'ë…¸ë™ìë“¤ì´ ì •ì¹˜ì  ê¶Œë¦¬ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.', effectStr: 'ë…¸ë™ ë¶ˆë§Œ +20%', action: () => { window.STATE.anger += 20; } },
        
        // ë°˜ë³µ ì¬ë‚œ
        { id: 'luddite', prob: 0.2, cond: (s) => s.anger > 60 && !s.isSabotaged, title: 'ëŸ¬ë‹¤ì´íŠ¸ ìš´ë™', desc: 'ë¶„ë…¸í•œ ë…¸ë™ìë“¤ì´ ê¸°ê³„ë¥¼ íŒŒê´´í•©ë‹ˆë‹¤!', effectStr: '8ì´ˆê°„ ìƒì‚° ì¤‘ë‹¨', action: () => sabotage(8000) },
        { id: 'cholera', prob: 0.2, cond: (s) => s.pollution > 70, title: 'ì½œë ˆë¼ ì°½ê¶', desc: 'ë¹„ìœ„ìƒì ì¸ í™˜ê²½ìœ¼ë¡œ ì „ì—¼ë³‘ì´ ë•ë‹ˆë‹¤.', effectStr: 'ìˆ˜ìµ 10% ê°ì†Œ', action: () => { window.STATE.income = Math.floor(window.STATE.income * 0.9); } }
    ];

    let eventCooldown = 0; 

    // --- ìˆ˜ì¹˜ ì²´í¬ í•¨ìˆ˜ (Clamp) ---
    function checkLimits() {
        window.STATE.pollution = Math.min(100, Math.max(0, window.STATE.pollution));
        window.STATE.anger = Math.min(100, Math.max(0, window.STATE.anger));
        window.STATE.bubble = Math.min(100, Math.max(0, window.STATE.bubble));
    }

    // --- ì‹¤í–‰ ë¡œì§ ---
    window.manualWork = function(e) {
        if(window.STATE.gameOver || window.STATE.isPaused || window.STATE.isSabotaged) return;
        addMoney(window.STATE.clickPower);
        
        const btn = document.getElementById('work-btn');
        const rect = btn.getBoundingClientRect();
        const x = e.clientX || (rect.left + rect.width/2);
        const y = e.clientY || (rect.top + rect.height/2);
        const el = document.createElement('div');
        el.className = 'float-money'; el.innerText = `+Â£${window.STATE.clickPower}`;
        el.style.left = x+'px'; el.style.top = y+'px';
        document.body.appendChild(el);
        setTimeout(()=>el.remove(), 800);

        // í´ë¦­ ì‹œ ë¯¸ì„¸í•œ ë¶ˆë§Œ ì¦ê°€ (ì™„í™”ë¨: 0.3)
        if(window.STATE.productStage >= 1) {
            window.STATE.anger += 0.3;
            checkLimits();
        }
    };

    function addMoney(val) {
        window.STATE.money = Math.max(0, window.STATE.money + val);
        updateUI();
    }

    // ê¸°ìˆ  êµ¬ë§¤
    window.buyTech = function(idx) {
        const tech = TECHS[idx];
        if(window.STATE.money < tech.cost) return;
        
        window.STATE.money -= tech.cost;
        if(tech.oneTime) window.STATE.purchasedTechs.push(tech.id);

        if(tech.type === 'click') window.STATE.clickPower += tech.val;
        if(tech.type === 'auto') window.STATE.income += tech.val;
        
        if(tech.type === 'stage') {
            window.STATE.productStage = tech.stage;
            if(tech.income) window.STATE.income += tech.income;
            if(tech.clickVal) window.STATE.clickPower += tech.clickVal;
            document.getElementById('prod-name').innerText = PRODUCTS[tech.stage];
        }

        if(tech.pollution) window.STATE.pollution += tech.pollution;
        if(tech.riskAnger) window.STATE.anger += tech.riskAnger;
        if(tech.anger) window.STATE.anger += tech.anger;
        if(tech.bubble) window.STATE.bubble += tech.bubble;

        checkLimits(); 

        if(tech.revealStats && !window.STATE.statsRevealed) triggerRevealStats();

        if(!tech.oneTime) tech.cost = Math.floor(tech.cost * 1.5);

        addNews(`[ê¸°ìˆ ] '${tech.name}' ì™„ë£Œ.`);
        renderLists(); updateUI();
    };

    // ì •ì±… ë„ì…
    window.buyPolicy = function(idx) {
        const pol = POLICIES[idx];
        
        if(pol.isEmergency) {
            if(window.STATE.bubble < 70) return; 
            if(confirm("ì¬ê³ ë¥¼ í—ê°’ì— ë„˜ê¸°ì‹œê² ìŠµë‹ˆê¹Œ? (ìë³¸ê¸ˆ 50% ì†ì‹¤)")) {
                window.STATE.money = Math.floor(window.STATE.money * 0.5);
                window.STATE.bubble = Math.max(0, window.STATE.bubble - 30);
                addNews("ğŸ“‰ ì¬ê³  ë¤í•‘: ë§‰ëŒ€í•œ ì†í•´ë¥¼ ê°ìˆ˜í–ˆìŠµë‹ˆë‹¤.");
                updateUI();
            }
            return;
        }

        if(window.STATE.money < pol.cost) return;

        window.STATE.money -= pol.cost;
        if(pol.oneTime) window.STATE.purchasedPolicies.push(pol.id);

        if(pol.type === 'suppress' || pol.type === 'soothe') {
            window.STATE.anger = Math.max(0, window.STATE.anger + pol.val);
            if(pol.sideEffect) window.STATE.angerRate += pol.sideEffect;
        }
        if(pol.type === 'reform') {
            window.STATE.anger = Math.max(0, window.STATE.anger + pol.val);
            if(pol.incomeNerf) window.STATE.income = Math.floor(window.STATE.income * pol.incomeNerf);
        }

        checkLimits();

        if(!pol.oneTime) pol.cost = Math.floor(pol.cost * 1.3);

        addNews(`[ì •ì±…] '${pol.name}' ì‹œí–‰.`);
        renderLists(); updateUI();
    };

    function triggerRevealStats() {
        window.STATE.statsRevealed = true;
        const reportEvt = { 
            title: "ì¶©ê²© ë³´ê³ ì„œ ê³µê°œ", 
            desc: "í™˜ê²½ ì˜¤ì—¼ê³¼ ë…¸ë™ìë“¤ì˜ ì°¸í˜¹í•œ ì‚¶ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.", 
            effectStr: "ì˜¤ì—¼/ë¶ˆë§Œ ìˆ˜ì¹˜ í•´ê¸ˆ",
            action: () => {
                document.getElementById('stat-pollution').classList.remove('hidden-stat');
                document.getElementById('stat-pollution').classList.add('revealed-stat');
                document.getElementById('stat-anger').classList.remove('hidden-stat');
                document.getElementById('stat-anger').classList.add('revealed-stat');
            }
        };
        window.STATE.pendingEvent = reportEvt;
        document.getElementById('alert-badge').style.display = 'block';
    }

    function updateUI() {
        document.getElementById('year').innerText = window.STATE.year;
        document.getElementById('month').innerText = window.STATE.month;
        
        document.getElementById('money').innerText = Math.floor(window.STATE.money).toLocaleString();
        document.getElementById('income').innerText = Math.floor(window.STATE.income).toLocaleString();
        document.getElementById('click-power').innerText = Math.floor(window.STATE.clickPower).toLocaleString();
        
        const bubble = window.STATE.bubble;
        const mStatus = document.getElementById('market-status');
        if(bubble < 30) { mStatus.innerText = "ì ì • (Stable)"; mStatus.style.color = "green"; mStatus.style.animation = "none"; }
        else if(bubble < 70) { mStatus.innerText = "ê³¼ì‰ (Surplus)"; mStatus.style.color = "orange"; mStatus.style.animation = "none"; }
        else { mStatus.innerText = "ìœ„í—˜ (Overproduction)"; mStatus.style.color = "red"; mStatus.style.animation = "blink 1s infinite"; }

        if(window.STATE.statsRevealed) {
            document.getElementById('pollution').innerText = Math.floor(window.STATE.pollution);
            document.getElementById('anger').innerText = Math.floor(window.STATE.anger);
        }

        let smogOp = Math.min(0.9, window.STATE.pollution / 150);
        document.getElementById('smog-layer').style.backgroundColor = `rgba(20, 20, 20, ${smogOp})`;

        if(window.STATE.anger > 30) {
            let angerOp = Math.min(0.8, (window.STATE.anger - 30) / 100);
            document.getElementById('anger-layer').style.boxShadow = `inset 0 0 100px 50px rgba(183, 28, 28, ${angerOp})`;
        } else {
            document.getElementById('anger-layer').style.boxShadow = `none`;
        }

        if(window.STATE.anger >= 100) document.getElementById('anger-layer').classList.add('critical-warning');
        else document.getElementById('anger-layer').classList.remove('critical-warning');

        renderLists(); 
    }

    function renderLists() {
        const techList = document.getElementById('tech-list');
        techList.innerHTML = '';
        
        let activeTechs = [];
        let doneTechs = [];

        TECHS.forEach((tech, idx) => {
            const div = document.createElement('div');
            div.className = 'tech-card card-base';
            let isBought = tech.oneTime && window.STATE.purchasedTechs.includes(tech.id);
            let isLocked = tech.req && !window.STATE.purchasedTechs.includes(tech.req);
            let isAffordable = !isBought && !isLocked && (window.STATE.money >= tech.cost);

            if(isBought) {
                div.classList.add('purchased');
                div.innerHTML = `<div><s>${tech.name}</s> (ì™„ë£Œ)</div><div>âœ…</div>`;
                doneTechs.push(div);
            } else if(isLocked) {
                div.classList.add('locked');
                div.innerHTML = `<div>ğŸ”’ ??? (Locked)</div>`;
                activeTechs.push(div);
            } else {
                if(!isAffordable) div.classList.add('disabled'); else div.classList.add('affordable');
                div.onclick = () => buyTech(idx);
                let desc = tech.desc;
                if(!window.STATE.statsRevealed) desc = desc.replace('ì˜¤ì—¼', '???').replace('ë¶ˆë§Œ', '???');
                div.innerHTML = `<div class="card-info"><h4>${tech.name}</h4><p>${desc}</p></div><div class="tech-cost tech-cost-badge">Â£${tech.cost.toLocaleString()}</div>`;
                activeTechs.push(div);
            }
        });
        
        activeTechs.forEach(el => techList.appendChild(el));
        doneTechs.forEach(el => techList.appendChild(el));

        const policyList = document.getElementById('policy-list');
        policyList.innerHTML = '';
        POLICIES.forEach((pol, idx) => {
            if(pol.isEmergency) {
                if(window.STATE.bubble >= 70) {
                    const div = document.createElement('div');
                    div.className = 'policy-card card-base affordable';
                    div.style.borderColor = '#d50000';
                    div.style.backgroundColor = '#ffebee';
                    div.onclick = () => buyPolicy(idx);
                    div.innerHTML = `<div class="card-info"><h4 style="color:#d50000;">${pol.name}</h4><p>${pol.desc}</p></div><div class="tech-cost" style="background:#d50000;">CLICK</div>`;
                    policyList.prepend(div);
                }
                return;
            }

            const div = document.createElement('div');
            div.className = 'policy-card card-base';
            let isBought = pol.oneTime && window.STATE.purchasedPolicies.includes(pol.id);
            let isLocked = pol.req && !window.STATE.purchasedTechs.includes(pol.req);
            let isAffordable = !isBought && !isLocked && (window.STATE.money >= pol.cost);

            if(isBought) { div.classList.add('active'); div.innerHTML = `<div>${pol.name} (ì‹œí–‰ì¤‘)</div><div>ğŸ›ï¸</div>`; }
            else if(isLocked) { div.style.display = 'none'; } 
            else {
                if(!isAffordable) div.classList.add('disabled'); else div.classList.add('affordable');
                div.onclick = () => buyPolicy(idx);
                div.innerHTML = `<div class="card-info"><h4>${pol.name}</h4><p>${pol.desc}</p></div><div class="tech-cost policy-cost-badge">Â£${pol.cost.toLocaleString()}</div>`;
                policyList.appendChild(div);
            }
        });
    }

    function addNews(text) {
        const list = document.getElementById('news-archive');
        const div = document.createElement('div');
        div.className = 'news-item';
        div.innerHTML = `[${window.STATE.year}.${window.STATE.month}] ${text}`;
        list.prepend(div);
    }

    function checkEvents() {
        if(window.STATE.pendingEvent) return;
        if(eventCooldown > 0) { eventCooldown--; return; }

        let candidates = EVENT_POOL.filter(evt => {
            if(evt.oneTime && window.STATE.history.includes(evt.id)) return false;
            if(evt.id === window.STATE.lastEventId) return false;
            return evt.cond(window.STATE);
        });

        if(candidates.length === 0) return;

        const shuffled = candidates.sort(() => 0.5 - Math.random());
        for (let evt of shuffled) {
            if(Math.random() < evt.prob) {
                triggerEvent(evt);
                break;
            }
        }
    }

    function triggerEvent(evt) {
        window.STATE.pendingEvent = evt;
        window.STATE.lastEventId = evt.id;
        if(evt.oneTime) window.STATE.history.push(evt.id);
        eventCooldown = 15; 
        document.getElementById('alert-badge').style.display = 'block';
    }

    window.openModal = function() {
        const evt = window.STATE.pendingEvent; if(!evt) return;
        window.STATE.isPaused = true;
        document.getElementById('modal-title').innerText = evt.title;
        document.getElementById('modal-body').innerText = evt.desc;
        
        if(evt.isDilemma) {
            document.getElementById('modal-confirm-area').style.display = 'none';
            const choiceArea = document.getElementById('modal-choice-area');
            choiceArea.style.display = 'flex';
            const btn1 = choiceArea.querySelector('.btn-opt1');
            const btn2 = choiceArea.querySelector('.btn-opt2');
            btn1.innerText = evt.choices[0].text;
            btn2.innerText = evt.choices[1].text;
        } else {
            document.getElementById('modal-confirm-area').style.display = 'block';
            document.getElementById('modal-choice-area').style.display = 'none';
            document.getElementById('modal-effect').innerText = evt.effectStr;
        }
        
        document.getElementById('news-modal').style.display = 'flex';
    };

    window.resolveDilemma = function(choiceIdx) {
        const evt = window.STATE.pendingEvent;
        if(evt && evt.choices) {
            evt.choices[choiceIdx].action();
        }
        window.closeModal();
    }

    window.closeModal = function() {
        const evt = window.STATE.pendingEvent;
        if(evt && !evt.isDilemma) {
            if(evt.action) evt.action(); 
            addNews(`<strong>[ì†ë³´] ${evt.title}</strong>`); 
        } else if(evt && !evt.isDilemma) {
            addNews(`<strong>[ì†ë³´] ${evt.title}</strong>`);
        }
        
        window.STATE.pendingEvent = null;
        window.STATE.isPaused = false;
        document.getElementById('news-modal').style.display = 'none';
        document.getElementById('alert-badge').style.display = 'none';
        
        checkLimits();
        updateUI();
    };

    function sabotage(ms) {
        window.STATE.isSabotaged = true;
        const btn = document.getElementById('work-btn');
        const tape = document.getElementById('sabotage-tape');
        const timer = document.getElementById('sabotage-timer');
        let timeLeft = ms / 1000;

        btn.disabled = true;
        tape.style.display = 'flex';
        timer.innerText = timeLeft + "s...";

        const interval = setInterval(() => {
            if(window.STATE.isPaused) return; 
            timeLeft--;
            timer.innerText = timeLeft + "s...";
            if(timeLeft <= 0) {
                clearInterval(interval);
                btn.disabled = false;
                tape.style.display = 'none';
                window.STATE.isSabotaged = false;
            }
        }, 1000);
    }

    function triggerEnding(type) {
        window.STATE.gameOver = true;
        const screen = document.getElementById('ending-screen');
        const title = document.getElementById('end-title');
        const body = document.getElementById('end-body');
        
        screen.style.display = 'flex';

        if(type === 'POLLUTION') {
            title.innerText = "ìƒíƒœê³„ì˜ ì¢…ë§";
            body.innerHTML = `
                "ëŸ°ë˜ì˜ í•˜ëŠ˜ì€ ë‚®ì—ë„ ê²€ì€ìƒ‰ì´ì—ˆë„¤. 
                ê°•ë¬¼ì€ ì•…ì·¨ë¡œ ì©ì–´ê°”ê³ , ì‚¬ëŒë“¤ì€ ë³‘ë“¤ì–´ ì“°ëŸ¬ì¡Œì§€.
                ìš°ë¦¬ëŠ” í™©ê¸ˆì„ ìœ„í•´ ìì—°ì„ ëª¨ë‘ íƒœì›Œë²„ë ¸ì–´.
                ì´ì œ ë‚¨ì€ ê²ƒì€ ì¬ì™€ í›„íšŒë¿ì´ë¼ë„¤."
                <br><br>
                - 19ì„¸ê¸° ì–´ëŠ ìë³¸ê°€ì˜ ìœ ì„œ ä¸­
            `;
        } else if(type === 'ANGER') {
            title.innerText = "í˜ëª…ì˜ ê¹ƒë°œ";
            body.innerHTML = `
                "ë” ì´ìƒ ì°¸ì„ ìˆ˜ ì—†ë‹¤! ê¸°ê³„ë¥¼ ë©ˆì¶”ì–´ë¼!"
                <br>
                ë¶„ë…¸í•œ ë…¸ë™ìë“¤ì´ ê³µì¥ì„ ì ê±°í•˜ê³  ê±°ë¦¬ëŠ” ë¶ˆê¸¸ì— íœ©ì‹¸ì˜€ìŠµë‹ˆë‹¤.
                ë‹¹ì‹ ì´ ìŒ“ì•„ì˜¬ë¦° ì œêµ­ì€ ë¯¼ì¤‘ì˜ ë¶„ë…¸ ì•ì— ë¬´ë„ˆì ¸ ë‚´ë ¸ìŠµë‹ˆë‹¤.
                ì¸ê°„ì„±ì„ ìƒì‹¤í•œ ì„±ì¥ì€ ì§€ì†ë  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.
            `;
        } else if(type === 'BUBBLE') {
            title.innerText = "ëŒ€ê³µí™© (The Great Depression)";
            body.innerHTML = `
                "ë¬¼ê±´ì€ ì‚°ë”ë¯¸ì²˜ëŸ¼ ìŒ“ì—¬ìˆëŠ”ë°, ì‚´ ì‚¬ëŒì´ ì—†ë‹¤ë„¤."
                <br>
                ê³¼ì‰ ìƒì‚°ìœ¼ë¡œ ì¸í•œ ì‹œì¥ì˜ ë¶•ê´´. ì£¼ì‹ì€ íœ´ì§€ì¡°ê°ì´ ë˜ì—ˆê³ ,
                ìˆ˜ë§Œ ëª…ì˜ ì‹¤ì—…ìê°€ ê±°ë¦¬ë¥¼ ë°°íšŒí•©ë‹ˆë‹¤.
                ì˜ì›í•  ê²ƒ ê°™ë˜ ë²ˆì˜ì€ ê±°í’ˆì²˜ëŸ¼ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.
            `;
        }
    }

    function gameLoop() {
        if(window.STATE.gameOver || window.STATE.isPaused) return;
        
        let currentIncome = window.STATE.income;
        if (window.STATE.isSabotaged) {
            currentIncome = 0; 
        } else if (window.STATE.anger >= 100) {
            currentIncome = Math.floor(currentIncome * 0.5); 
            if(Math.random() < 0.1) sabotage(3000);
        }
        addMoney(currentIncome);
        
        if(!window.STATE.isSabotaged && currentIncome > 50) {
            window.STATE.bubble += (currentIncome * 0.0002);
        }

        if(window.STATE.income > 100) window.STATE.anger += window.STATE.angerRate;

        if(window.STATE.pollution >= 100) { triggerEnding('POLLUTION'); return; }
        if(window.STATE.anger >= 100) { triggerEnding('ANGER'); return; } 
        if(window.STATE.bubble >= 100) { triggerEnding('BUBBLE'); return; }

        checkLimits();

        window.STATE.month += 4;
        if(window.STATE.month > 12) {
            window.STATE.month = 1;
            window.STATE.year++;
        }

        checkEvents();

        if(window.STATE.year >= 1930) {
            alert("1930ë…„ ë„ë‹¬.\nì‚°ì—…í˜ëª…ì˜ ì‹œëŒ€ê°€ ë§‰ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤.\nìµœì¢… ìì‚°: Â£" + Math.floor(window.STATE.money));
            window.STATE.gameOver = true;
            location.reload();
        }
        
        updateUI();
    }

    window.onload = function() {
        renderLists(); addNews("ì‚¬ì—… ì‹œì‘: ì‘ì€ ê³µë°©ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.");
        setInterval(gameLoop, 1000); 
    };

</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive: The Miracle Probability</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-cyan: #00d2d3;
            --neon-red: #ff6b6b;
            --card-bg: rgba(15, 15, 20, 0.85); /* 투명도 조절 */
            --header-bg: rgba(0, 0, 0, 0.9);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            color: white;
            overflow: hidden;
            user-select: none;
        }

        /* [NEW] 1. 움직이는 배경 레이어 */
        #bg-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        #bg-image {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 0.5s ease-in-out;
            /* 켄 번스 효과: 천천히 확대됨 */
            animation: kenBurns 20s infinite alternate linear;
        }

        @keyframes kenBurns {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }

        /* [NEW] 2. 어두운 오버레이 + 스캔라인 효과 */
        #bg-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); /* 기본 어두움 */
            z-index: -1;
            /* CRT 모니터 같은 스캔라인 */
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 6px 100%;
            pointer-events: none;
        }

        /* [NEW] 3. 떠다니는 입자 (Particles) */
        .particle {
            position: absolute;
            border-radius: 50%;
            background: white;
            opacity: 0.5;
            bottom: -10px;
            animation: floatUp linear infinite;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(20px); opacity: 0; }
        }

        /* 게임 프레임 */
        #game-frame {
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 550px;
            height: auto;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(0, 210, 211, 0.2); /* 네온 글로우 추가 */
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px); /* 유리 효과 */
        }

        /* 헤더 */
        .header-panel {
            background: var(--header-bg);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--neon-cyan);
            flex-shrink: 0;
        }

        .header-title {
            color: var(--neon-cyan);
            font-weight: 800;
            letter-spacing: 1px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-value {
            font-size: 1.4rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 10px var(--neon-cyan);
            font-variant-numeric: tabular-nums;
        }

        .header-panel.reveal {
            border-bottom-color: var(--neon-red);
        }
        .header-panel.reveal .header-title { color: var(--neon-red); }
        .header-panel.reveal .header-value { color: var(--neon-red); text-shadow: 0 0 15px var(--neon-red); }

        /* 컨텐츠 패널 */
        .content-panel {
            background: var(--card-bg);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .content-panel::-webkit-scrollbar { width: 4px; }
        .content-panel::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }

        .era-badge {
            background: var(--neon-cyan);
            color: black;
            font-size: 0.75rem;
            font-weight: 900;
            padding: 4px 10px;
            border-radius: 4px;
            width: fit-content;
            margin-bottom: 15px;
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--neon-cyan); /* 뱃지 빛남 */
        }

        .story-title {
            font-size: 1.6rem;
            font-weight: 800;
            margin: 0 0 15px 0;
            line-height: 1.3;
        }

        .story-desc {
            font-size: 1.05rem;
            line-height: 1.6;
            color: #dcdcdc;
            text-align: justify;
        }

        .hl { color: var(--neon-cyan); font-weight: bold; }

        /* 선택지 영역 */
        .choice-area {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 20px;
        }

        .choice-label {
            font-size: 0.8rem;
            color: #888;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .choice-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .choice-btn:hover {
            background: white;
            color: black;
            transform: translateY(-2px);
            font-weight: 800;
            box-shadow: 0 0 15px rgba(255,255,255,0.5); /* 호버 시 빛남 */
        }
        
        .choice-btn:active { transform: scale(0.98); }

        /* 리플 효과 */
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple-animation {
            to { transform: scale(4); opacity: 0; }
        }

        /* 팝업 */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .popup-box { max-width: 450px; text-align: center; }
        .fail-title { font-size: 2.2rem; font-weight: 900; color: #777; margin-bottom: 15px; }
        .fail-msg { font-size: 1.1rem; line-height: 1.6; color: #ccc; margin-bottom: 30px; }
        
        .ending-title { 
            font-size: 2.5rem; 
            font-weight: 900; 
            color: var(--neon-red); 
            margin-bottom: 20px;
            animation: pulseText 2s infinite; 
        }

        @keyframes pulseText {
            0% { text-shadow: 0 0 10px var(--neon-red); }
            50% { text-shadow: 0 0 30px var(--neon-red); }
            100% { text-shadow: 0 0 10px var(--neon-red); }
        }

        .ending-msg { font-size: 1.1rem; line-height: 1.7; color: #eee; text-align: left; margin-bottom: 30px; word-break: keep-all; }

        .btn-reset {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-reset:hover { background: white; color: black; box-shadow: 0 0 20px white; }

    </style>
</head>
<body>

    <div id="bg-container">
        <div id="bg-image"></div>
    </div>
    
    <div id="bg-overlay"></div>

    <div id="particles"></div>

    <div id="game-frame">
        <div class="header-panel" id="header-panel">
            <div class="header-title" id="header-label">
                <i class="fas fa-database"></i> ARCHIVE STATUS
            </div>
            <div class="header-value" id="header-value">100%</div>
        </div>

        <div class="content-panel" id="content-panel">
            <div class="era-badge" id="era-badge">ERA: ???</div>
            <h1 class="story-title" id="story-title">Loading...</h1>
            <div class="story-desc" id="story-desc"></div>

            <div class="choice-area">
                <div class="choice-label">
                    <i class="fas fa-mouse-pointer"></i> SELECT ACTION
                </div>
                <div id="btn-group" style="display: flex; flex-direction: column; gap: 10px;"></div>
            </div>
        </div>
    </div>

    <div class="overlay" id="fail-overlay">
        <div class="popup-box">
            <div class="fail-title">HISTORY LOST</div>
            <p class="fail-msg" id="fail-msg">...</p>
            <button class="btn-reset" onclick="closeFail()">SYSTEM REBOOT</button>
        </div>
    </div>

    <div class="overlay" id="ending-overlay">
        <div class="popup-box">
            <div class="ending-title">COMPLETE</div>
            <div class="ending-msg">
                지금까지 보신 확률은 인류가 멸망하지 않고<br>
                당신이 <b>'생존'</b>하여 지금에 이를 확률이었습니다.<br><br>

                그리고 마지막 선택.<br>
                우리가 <b>'같은 시대'</b>, <b>'같은 지역'</b>에 살고,<br>
                하필이면 <b>'이 교실'</b>에서 마주 보고 앉아있을 확률.<br><br>

                이것은 수학적으로 계산이 불가능한<br>
                <span style="color:#ff6b6b; font-weight:bold; font-size:1.6rem;">기적 (MIRACLE)</span>입니다.<br><br>

                우리의 만남은 우연이 아닌 역사적 필연입니다.<br>
                이 기적을 지키기 위해, 당신은 무엇을 하시겠습니까?
            </div>
            <button class="btn-reset" onclick="location.reload()" style="border-color:#ff6b6b; color:#ff6b6b;">ARCHIVE RESET</button>
        </div>
    </div>

    <script>
        const BG = {
            VOLCANO: "url('https://images.unsplash.com/photo-1469598614039-ccfeb0a21111?q=80&w=1000')", 
            FARM: "url('https://images.unsplash.com/photo-1500937386664-56d1dfef3854?q=80&w=1000')",
            GREECE: "url('https://images.unsplash.com/photo-1555662703-e621f3f77365?q=80&w=1000')",
            ROME: "url('https://images.unsplash.com/photo-1552483775-db3262319df6?q=80&w=1000')",
            PLAGUE: "url('https://images.unsplash.com/photo-1519074069444-1ba4fff66d16?q=80&w=1000')", 
            SHIP: "url('https://images.unsplash.com/photo-1559136555-9303dff5a98b?q=80&w=1000')",
            FIRE: "url('https://images.unsplash.com/photo-1509653087866-91f6c2ab5e47?q=80&w=1000')",
            VAX: "url('https://images.unsplash.com/photo-1584036561566-b93708e019b7?q=80&w=1000')",
            FLU: "url('https://images.unsplash.com/photo-1580130601275-c960436d9361?q=80&w=1000')",
            WAR: "url('https://images.unsplash.com/photo-1626296185288-032049444458?q=80&w=1000')",
            KOREA: "url('https://images.unsplash.com/photo-1533613220915-609f661a6fe1?q=80&w=1000')",
            COLD: "url('https://images.unsplash.com/photo-1616422209146-5c5a4d693526?q=80&w=1000')",
            LOVE: "url('https://images.unsplash.com/photo-1496345875659-11f7dd282d1d?q=80&w=1000')",
            SCHOOL: "url('https://images.unsplash.com/photo-1588072432836-e10032774350?q=80&w=1000')"
        };

        const stages = [
            {
                era: "BC 74,000 | PALEOLITHIC",
                title: "토바 화산 대폭발",
                desc: "인도네시아 토바 화산 폭발로 <span class='hl'>'화산 겨울'</span>이 닥쳤습니다. 인류의 90%가 멸종하고 전 세계 생존자는 고작 2,000명입니다. 멸종 위기입니다.",
                bg: BG.VOLCANO,
                prob: "1 / 1",
                options: [
                    { text: "부족끼리 식량을 뺏고 전쟁을 한다.", correct: false, msg: "내전과 추위로 인류는 자멸했습니다." },
                    { text: "너무 추우니 동굴 안에서만 버틴다.", correct: false, msg: "자원 고갈로 고립되어 멸종했습니다." },
                    { text: "위험을 무릅쓰고 따뜻한 적도로 이동한다.", correct: true }
                ]
            },
            {
                era: "BC 10,000 | NEOLITHIC",
                title: "신석기 혁명",
                desc: "마지막 빙하기가 끝났습니다. 인류는 우연히 씨앗에서 싹이 트는 것을 발견했습니다. 이것은 <span class='hl'>'농경'</span>의 시작이자 정착 생활의 기회였습니다.",
                bg: BG.FARM,
                prob: "1 / 10",
                options: [
                    { text: "농사는 너무 힘들어. 다시 사냥하러 간다.", correct: false, msg: "식량 생산량을 늘리지 못해 인류 문명은 정체되었습니다." },
                    { text: "씨앗을 다 먹어 치우고 이동한다.", correct: false, msg: "미래의 식량을 먹어버려 굶어 죽었습니다." },
                    { text: "힘들지만 정착하여 마을을 이루고 농사짓는다.", correct: true }
                ]
            },
            {
                era: "BC 430 | ANCIENT GREECE",
                title: "아테네 대역병",
                desc: "아테네 인구의 1/3이 죽어가는 전염병이 돌고 있습니다. 지도자 페리클레스도 사망했습니다. 도시는 공포에 빠졌습니다.",
                bg: BG.GREECE,
                prob: "1 / 100",
                options: [
                    { text: "신들의 벌이다. 신전에 모여 기도한다.", correct: false, msg: "밀집된 신전에서 전염병이 폭발적으로 확산되었습니다." },
                    { text: "죽은 자들의 옷을 챙겨 입는다.", correct: false, msg: "오염된 옷을 통해 감염되어 사망했습니다." },
                    { text: "사람들과 접촉을 피하고 위생을 챙긴다.", correct: true }
                ]
            },
            {
                era: "AD 79 | ROMAN EMPIRE",
                title: "폼페이 최후의 날",
                desc: "베수비오 화산이 폭발했습니다. 화산재가 도시를 덮칩니다. 귀족들은 재산을 지키려 합니다.",
                bg: BG.ROME,
                prob: "1 / 5,000",
                options: [
                    { text: "재산을 지키기 위해 튼튼한 지하실로 숨는다.", correct: false, msg: "유독 가스와 화쇄류가 지하실을 덮쳐 화석이 되었습니다." },
                    { text: "신전으로 가서 신의 자비를 구한다.", correct: false, msg: "신전 지붕이 화산재 무게를 이기지 못하고 무너졌습니다." },
                    { text: "모든 것을 버리고 바다 쪽으로 전력 질주한다.", correct: true }
                ]
            },
            {
                era: "AD 1347 | MIDDLE AGES",
                title: "흑사병 (The Black Death)",
                desc: "유럽 인구의 절반이 사망했습니다. 사람들은 병의 원인이 '나쁜 공기'나 '신벌'이라고 생각했습니다.",
                bg: BG.PLAGUE,
                prob: "1 / 10만",
                options: [
                    { text: "고양이가 마녀의 부하라고 믿고 죽인다.", correct: false, msg: "고양이가 사라지자 쥐가 급증하여 병이 더 빨리 퍼졌습니다." },
                    { text: "환자의 곁을 지키며 지극정성 간호한다.", correct: false, msg: "전염을 피할 수 없어 가문이 몰살당했습니다." },
                    { text: "항구에 들어온 배를 40일간 격리(Quarantine)한다.", correct: true }
                ]
            },
            {
                era: "AD 1592 | JOSEON DYNASTY",
                title: "임진왜란과 이순신",
                desc: "일본군이 파죽지세로 한양을 점령했습니다. 조선 수군은 절대적인 열세입니다. 이순신 장군은 마지막 결전을 준비합니다.",
                bg: BG.SHIP,
                prob: "1 / 50만",
                options: [
                    { text: "승산이 없다. 배를 버리고 육지에서 싸운다.", correct: false, msg: "육지전에서 패배하여 조선은 함락되었습니다. 역사가 바뀝니다." },
                    { text: "명나라 지원군이 올 때까지 숨어서 기다린다.", correct: false, msg: "그 사이 일본군에게 보급로를 내주어 전쟁에서 패했습니다." },
                    { text: "12척의 배로 133척의 적을 울돌목으로 유인한다.", correct: true }
                ]
            },
            {
                era: "AD 1666 | LONDON",
                title: "런던 대화재",
                desc: "런던 전체가 불타고 있습니다. 불길이 집 앞까지 닥쳤습니다.",
                bg: BG.FIRE,
                prob: "1 / 1,000만",
                options: [
                    { text: "평생 모은 금화를 챙기러 집으로 들어간다.", correct: false, msg: "재산을 챙기다 탈출 타이밍을 놓쳤습니다." },
                    { text: "불길을 잡기 위해 양동이로 물을 뿌린다.", correct: false, msg: "거대한 불길을 잡기엔 역부족이었습니다." },
                    { text: "모든 것을 포기하고 템즈강으로 뛰어든다.", correct: true }
                ]
            },
            {
                era: "AD 1796 | MEDICAL REVOLUTION",
                title: "천연두와 백신",
                desc: "치사율 30%의 천연두. 제너가 '소의 고름(우두)'을 맞으면 예방된다고 주장합니다.",
                bg: BG.VAX,
                prob: "1 / 5,000만",
                options: [
                    { text: "사람이 소가 될 순 없다! 접종을 거부한다.", correct: false, msg: "천연두에 감염되어 사망했습니다." },
                    { text: "민간요법인 부적을 붙이고 굿을 한다.", correct: false, msg: "미신은 바이러스를 막지 못했습니다." },
                    { text: "두렵지만 최초의 백신을 접종한다.", correct: true }
                ]
            },
            {
                era: "AD 1918 | PANDEMIC",
                title: "스페인 독감",
                desc: "1차 대전 직후, 전 세계 5억 명이 감염된 독감이 돌고 있습니다.",
                bg: BG.FLU,
                prob: "1 / 1억",
                options: [
                    { text: "전쟁 승리를 축하하는 퍼레이드에 참가한다.", correct: false, msg: "군중 속에서 집단 감염되어 사망했습니다." },
                    { text: "독감은 감기일 뿐이다. 마스크 없이 다닌다.", correct: false, msg: "방심한 사이 바이러스에 감염되었습니다." },
                    { text: "마스크를 쓰고 인파가 모인 곳을 피한다.", correct: true }
                ]
            },
            {
                era: "AD 1950 | KOREAN WAR",
                title: "흥남 철수 작전",
                desc: "포위된 흥남 부두. 메러디스 빅토리호 앞에 14,000명의 피난민이 살려달라고 애원합니다. 선장은 결단을 내려야 합니다.",
                bg: BG.KOREA,
                prob: "1 / 5억",
                options: [
                    { text: "규정상 민간인은 태울 수 없다. 군인만 철수한다.", correct: false, msg: "피난민들 속에 있던 당신의 조부모님이 생존하지 못했습니다." },
                    { text: "무기를 싣고 남은 공간에만 사람을 태운다.", correct: false, msg: "공간 부족으로 당신의 조부모님은 배에 타지 못했습니다." },
                    { text: "배에 실은 25만 톤의 무기를 모두 버리고 사람을 태운다.", correct: true }
                ]
            },
            {
                era: "AD 1962 | COLD WAR",
                title: "핵전쟁 위기",
                desc: "소련 잠수함 B-59. 미군의 공격을 받고 통신이 끊겼습니다. 함장은 핵 발사를 명령합니다.",
                bg: BG.COLD,
                prob: "1 / 30억",
                options: [
                    { text: "규정대로 핵 발사 버튼을 누른다.", correct: false, msg: "핵전쟁으로 1962년에 인류 문명이 멸망했습니다." },
                    { text: "반격하지 말고 잠수함을 자폭시킨다.", correct: false, msg: "상황을 오판한 소련군이 전면전을 개시하여 멸망했습니다." },
                    { text: "부함장 아르키포프의 의견대로 발사를 거부한다.", correct: true }
                ]
            },
            {
                era: "1980~90s | DESTINY",
                title: "낯선 두 사람",
                desc: "어느 날, 번화가에서 낯선 남녀가 우연히 마주칩니다. 3초 뒤면 그들은 영영 스쳐 지나가게 됩니다. 한 번의 선택이 미래를 바꿀 수 있습니다.",
                bg: BG.LOVE,
                prob: "1 / 45억",
                options: [
                    { text: "부끄러워서 고개를 숙이고 지나간다.", correct: false, msg: "두 남녀는 남남이 되었고, 미래의 연결고리는 사라졌습니다." },
                    { text: "타이밍을 놓쳐서 말 걸 기회를 잃는다.", correct: false, msg: "망설이는 사이 인연은 사라졌습니다." },
                    { text: "용기를 내어 상대에게 말을 건다.", correct: true }
                ]
            },
            {
                era: "2024 | CLASSROOM",
                title: "만남의 확률",
                desc: "이 학교에도 여러 개의 반이 있습니다. 벽 하나만 사이에 두고 1년 내내 얼굴도 모른 채 지낼 수도 있었습니다.",
                bg: BG.SCHOOL,
                prob: "1 / 4000조",
                options: [
                    { text: "바로 옆 반에 배정된다.", correct: false, msg: "옆 반이었지만, 우리는 서로 이름도 모른 채 졸업했습니다." },
                    { text: "다른 층에 있는 반에 배정된다.", correct: false, msg: "동선이 겹치지 않아 한 번도 마주치지 못했습니다." },
                    { text: "기적처럼 '이 반' 명단에 함께 이름이 올랐다.", correct: true }
                ]
            },
            {
                era: "NOW | PRESENT",
                title: "연결된 우리",
                desc: "이 모든 확률을 뚫고 만났습니다. 하지만 현대 사회의 갈등이 우리의 연결을 다시 위협합니다.",
                bg: BG.SCHOOL,
                prob: "1 / ∞",
                options: [
                    { text: "나 하나쯤이야. 무관심하게 산다.", correct: false, msg: "우리의 연결은 끊어지고 기적은 멈췄습니다." },
                    { text: "갈등은 어쩔 수 없다. 포기한다.", correct: false, msg: "포기하는 순간 역사의 발전도 멈췄습니다." },
                    { text: "이 기적을 지키기 위해 옆 친구와 연대한다.", correct: true }
                ]
            }
        ];

        let currentIdx = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 숫자 해킹 효과
        function animateValue(element, target, duration) {
            const originalText = target;
            const possibleChars = "1234567890/.,%#@?!";
            let startTime = null;

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = timestamp - startTime;
                
                if (progress < duration) {
                    let scrambled = "";
                    for(let i=0; i<originalText.length; i++) {
                        scrambled += possibleChars.charAt(Math.floor(Math.random() * possibleChars.length));
                    }
                    element.innerText = scrambled;
                    window.requestAnimationFrame(step);
                } else {
                    element.innerText = originalText;
                }
            }
            window.requestAnimationFrame(step);
        }

        // 파티클 생성 함수
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 30;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // 랜덤 위치 및 크기
                const size = Math.random() * 5 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}vw`;
                
                // 랜덤 애니메이션 속도
                const duration = Math.random() * 10 + 5;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                
                container.appendChild(particle);
            }
        }

        function init() {
            renderStage();
            createParticles(); // 파티클 시작
        }

        function renderStage() {
            const stage = stages[currentIdx];
            
            // 배경 이미지 변경 (켄 번스 효과를 위해 div에 적용)
            const bgImage = document.getElementById('bg-image');
            bgImage.style.backgroundImage = stage.bg;

            document.getElementById('era-badge').innerText = stage.era;
            document.getElementById('story-title').innerText = stage.title;
            document.getElementById('story-desc').innerHTML = stage.desc;

            const headerLabel = document.getElementById('header-label');
            const headerValue = document.getElementById('header-value');
            const headerPanel = document.getElementById('header-panel');

            // 숫자 변경 애니메이션
            animateValue(headerValue, stage.prob, 800);

            if (currentIdx < stages.length - 1) {
                headerLabel.innerHTML = '<i class="fas fa-database"></i> ARCHIVE STATUS';
                headerPanel.classList.remove("reveal");
            } else {
                headerLabel.innerHTML = '<i class="fas fa-database"></i> ARCHIVE STATUS';
            }

            const btnGroup = document.getElementById('btn-group');
            btnGroup.innerHTML = '';

            const currentOptions = [...stage.options];
            shuffle(currentOptions);

            currentOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.innerText = opt.text;
                
                btn.onclick = (e) => {
                    createRipple(e);
                    setTimeout(() => handleChoice(opt), 300);
                };
                
                btnGroup.appendChild(btn);
            });
            
            document.getElementById('content-panel').scrollTop = 0;
        }

        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
            circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
            circle.classList.add("ripple");

            const ripple = button.getElementsByClassName("ripple")[0];
            if (ripple) {
                ripple.remove();
            }
            button.appendChild(circle);
        }

        function handleChoice(opt) {
            if (opt.correct) {
                if (currentIdx < stages.length - 1) {
                    currentIdx++;
                    renderStage();
                } else {
                    revealTruth();
                }
            } else {
                document.getElementById('fail-msg').innerText = opt.msg;
                document.getElementById('fail-overlay').style.display = 'flex';
            }
        }

        function revealTruth() {
            const headerPanel = document.getElementById('header-panel');
            document.getElementById('header-label').innerHTML = '<i class="fas fa-heart"></i> 우리가 만날 확률';
            document.getElementById('header-value').innerText = "기적";
            headerPanel.classList.add("reveal");

            setTimeout(() => {
                document.getElementById('ending-overlay').style.display = 'flex';
            }, 1000);
        }

        function closeFail() {
            document.getElementById('fail-overlay').style.display = 'none';
        }

        window.onload = init;
    </script>
</body>
</html>
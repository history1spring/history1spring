<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>French Revolution</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Nanum+Myeongjo:wght@400;700;800&display=swap');

        :root {
            --bg-color: #2c3e50;
            --card-bg: #fdf5e6;
            --text-color: #2c3e50;
            --accent: #c0392b; 
            --bar-fill: rgba(39, 174, 96, 0.9);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Nanum Myeongjo', serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* [1] ì‹œì‘ í™”ë©´ */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #002395 0%, #1a1a1a 50%, #ed2939 100%);
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center; padding: 20px;
        }
        .start-box {
            background: rgba(0, 0, 0, 0.6); padding: 40px; border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.5); box-shadow: 0 0 50px rgba(0,0,0,0.8);
            max-width: 500px; width: 95%; backdrop-filter: blur(5px); animation: fadeIn 1s ease-out;
        }
        .start-btn {
            padding: 15px 50px; font-size: 1.3rem; font-weight: bold; cursor: pointer;
            background: #fdf5e6; color: #2c3e50; border: none; border-radius: 50px;
            font-family: 'Nanum Myeongjo'; transition: transform 0.2s; margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .start-btn:hover { transform: scale(1.05); }

        /* [2] ê²Œì„ í™”ë©´ */
        #game-screen {
            display: none; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 100%; padding-top: 10px; animation: slideUp 0.8s ease-out;
        }

        /* ìŠ¤íƒ¯ UI */
        .stats-container { display: flex; gap: 10px; margin-bottom: 20px; width: 340px; justify-content: space-between; }
        .stat-wrapper { 
            display: flex; flex-direction: column; align-items: center; gap: 5px; width: 25%; 
            position: relative; 
        }
        
        .stat-icon {
            width: 50px; height: 50px; border-radius: 50%; background: #34495e; color: white;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
            position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.3); 
            overflow: hidden; 
            border: 2px solid #ecf0f1; z-index: 1;
        }
        
        .indicator-dot {
            position: absolute; top: 0px; right: 5px; width: 12px; height: 12px;
            background-color: #f1c40f; border: 2px solid #fff; border-radius: 50%;
            display: none; z-index: 10; box-shadow: 0 0 5px #f1c40f; 
            animation: bounceDot 0.5s infinite alternate;
        }

        .emoji-layer { position: relative; z-index: 5; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .stat-bar {
            position: absolute; bottom: 0; left: 0; width: 100%; background: var(--bar-fill); height: 50%; 
            transition: height 0.5s; z-index: 1; opacity: 0.8;
        }
        .stat-danger .stat-bar { background: #e74c3c !important; animation: pulseBar 0.5s infinite alternate; }
        .stat-label { font-size: 0.8rem; font-weight: bold; color: #ecf0f1; text-shadow: 1px 1px 2px black; }

        /* ì¸ë²¤í† ë¦¬ */
        .inventory-container {
            display: flex; gap: 10px; margin-bottom: 20px; width: 340px; justify-content: center;
            background: rgba(0,0,0,0.2); padding: 8px; border-radius: 10px;
            position: relative; z-index: 50; /* ì¸ë²¤í† ë¦¬ ìì²´ ë ˆì´ì–´ ë†’ì„ */
        }
        .item-slot {
            width: 45px; height: 45px; background: rgba(255,255,255,0.1); border: 1px dashed #7f8c8d;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; cursor: help; position: relative; transition: all 0.3s;
        }
        .item-slot.active { background: rgba(255,255,255,0.9); border: 2px solid #f1c40f; box-shadow: 0 0 15px #f1c40f; transform: scale(1.1); cursor: pointer; }
        
        /* íˆ´íŒ ìŠ¤íƒ€ì¼ (ìˆ˜ì •ë¨) */
        .item-slot[data-tooltip]:hover::after {
            content: attr(data-tooltip); 
            position: absolute; 
            bottom: 130%; /* ìŠ¬ë¡¯ë³´ë‹¤ ë” ìœ„ë¡œ */
            left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.95); 
            color: #fff; 
            padding: 10px; 
            border-radius: 8px; 
            font-size: 0.85rem; 
            z-index: 9999; /* ìµœìƒë‹¨ ë³´ì¥ */
            pointer-events: none;
            
            /* ì¤„ë°”ê¿ˆ ë° í¬ê¸° ì„¤ì • */
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ë¬¸ì(\n) ì¸ì‹ */
            width: 200px; /* ë„‰ë„‰í•œ ë„ˆë¹„ */
            text-align: center;
            line-height: 1.4;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            border: 1px solid #7f8c8d;
        }
        /* íˆ´íŒ í™”ì‚´í‘œ */
        .item-slot[data-tooltip]:hover::before {
            content: ''; position: absolute; bottom: 110%; left: 50%; margin-left: -6px;
            border-width: 6px; border-style: solid; border-color: transparent transparent transparent transparent;
            border-top-color: rgba(0,0,0,0.95); z-index: 9999;
        }

        /* ì¹´ë“œ ì˜ì—­ */
        .game-area { position: relative; width: 320px; height: 440px; margin-top: 20px; z-index: 1; }
        .year-display {
            position: absolute; top: -50px; width: 100%; text-align: center;
            color: #ecf0f1; font-family: 'Cinzel'; font-size: 2.2rem; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .card {
            width: 100%; height: 100%; background: var(--card-bg); border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: absolute; top: 0; left: 0;
            display: flex; flex-direction: column; align-items: center; padding: 25px;
            border: 6px solid #8b7355; 
        }
        .card-image {
            width: 100%; height: 160px; background: #ecf0f1; margin-bottom: 20px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 5rem;
            color: #7f8c8d; border: 2px dashed #bdc3c7; position: relative;
        }
        .npc-badge {
            position: absolute; top: -10px; right: -10px; background: #e67e22; color: white;
            padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); transform: rotate(10deg);
        }
        .card-title {
            font-family: 'Cinzel', serif; font-size: 1.4rem; margin-bottom: 10px; text-align: center;
            border-bottom: 2px double var(--accent); padding-bottom: 5px; color: var(--accent); width: 100%;
        }
        .card-desc { 
            font-size: 1.1rem; text-align: center; line-height: 1.5; flex: 1; 
            display: flex; align-items: center; justify-content: center; 
            word-break: normal; word-wrap: break-word; overflow-wrap: break-word;
        }

        /* ì»¨íŠ¸ë¡¤ */
        .controls { width: 320px; display: flex; justify-content: space-between; margin-top: 25px; margin-bottom: 20px; }
        .btn {
            width: 48%; min-height: 60px; padding: 10px; border: none; border-radius: 12px;
            font-family: 'Nanum Myeongjo'; font-weight: bold; font-size: 0.95rem;
            cursor: pointer; box-shadow: 0 5px 0 rgba(0,0,0,0.3); transition: transform 0.1s; color: white;
            display: flex; align-items: center; justify-content: center; text-align: center; word-break: keep-all; line-height: 1.3;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-left { background: #c0392b; }
        .btn-right { background: #27ae60; }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .swipe-left { transform: translateX(-150%) rotate(-30deg) !important; opacity: 0; transition: 0.3s ease-in !important; }
        .swipe-right { transform: translateX(150%) rotate(30deg) !important; opacity: 0; transition: 0.3s ease-in !important; }

        /* íŒì—… */
        #ending-overlay, #item-popup, #passive-popup {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 300;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center; padding: 30px;
        }
        #item-popup, #passive-popup { background: rgba(0,0,0,0.85); z-index: 200; }
        .pop-card { background: #fff; color: #333; padding: 30px; border-radius: 20px; width: 320px; box-shadow: 0 0 50px rgba(255,255,255,0.2); animation: popIn 0.3s; }

        @keyframes pulseBar { 0% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes popIn { 0% { transform: scale(0.5); opacity:0; } 100% { transform: scale(1); opacity:1; } }
        @keyframes bounceDot { 0% { transform: scale(1); } 100% { transform: scale(1.3); } }

    </style>
</head>
<body>

<div id="start-screen">
    <div class="start-box">
        <div style="font-size:4rem; margin-bottom:15px;">ğŸ‡«ğŸ‡·</div>
        <h1 style="font-family:'Cinzel'; font-size:2.5rem; margin:0; text-shadow:2px 2px 0 #c0392b;">RÃ‰VOLUTION<br>1789-1799</h1>
        <p style="color:#ddd; font-style:italic;">"ììœ ê°€ ì•„ë‹ˆë©´ ì£½ìŒì„"</p>
        <div style="font-size:1.1rem; line-height:1.8; margin:30px 0; color:#ecf0f1; border-top:1px solid #777; border-bottom:1px solid #777; padding:20px 0;">
            ë‹¹ì‹ ì€ í˜ëª…ì˜ ì†Œìš©ëŒì´ ì†ì— ì„  <strong>ìš´ëª…ì˜ ì¡°ì •ì</strong>ì…ë‹ˆë‹¤.<br>
            ë¯¼ì‹¬, êµ­ê³ , í˜ëª… ì—´ê¸°, êµ°ì‚¬ë ¥<br>
            4ê°€ì§€ í˜ì˜ ê· í˜•ì„ ìœ ì§€í•˜ë©°<br>
            <strong>1799ë…„ ë‚˜í´ë ˆì˜¹ ì§‘ê¶Œ ì „ê¹Œì§€ ìƒì¡´í•˜ì‹­ì‹œì˜¤.</strong>
        </div>
        <button class="start-btn" onclick="startGame()">í˜ëª…ì˜ ì†Œìš©ëŒì´ë¡œ (START)</button>
    </div>
</div>

<div id="game-screen">
    <div class="stats-container">
        <div class="stat-wrapper">
            <div class="stat-icon" id="icon-bread">
                <span class="emoji-layer">ğŸ¥–</span><div class="stat-bar" id="fill-bread" style="height:50%"></div>
            </div>
            <div class="indicator-dot" id="dot-bread"></div>
            <div class="stat-label">ë¯¼ì‹¬</div>
        </div>
        <div class="stat-wrapper">
            <div class="stat-icon" id="icon-money">
                <span class="emoji-layer">ğŸ’°</span><div class="stat-bar" id="fill-money" style="height:50%"></div>
            </div>
            <div class="indicator-dot" id="dot-money"></div>
            <div class="stat-label">êµ­ê³ </div>
        </div>
        <div class="stat-wrapper">
            <div class="stat-icon" id="icon-rev">
                <span class="emoji-layer">ğŸ”¥</span><div class="stat-bar" id="fill-rev" style="height:50%"></div>
            </div>
            <div class="indicator-dot" id="dot-rev"></div>
            <div class="stat-label">í˜ëª…</div>
        </div>
        <div class="stat-wrapper">
            <div class="stat-icon" id="icon-army">
                <span class="emoji-layer">âš”ï¸</span><div class="stat-bar" id="fill-army" style="height:50%"></div>
            </div>
            <div class="indicator-dot" id="dot-army"></div>
            <div class="stat-label">êµ°ì‚¬</div>
        </div>
    </div>

    <div class="inventory-container">
        <div class="item-slot" id="slot-0" onclick="showItemDesc(this)"></div>
        <div class="item-slot" id="slot-1" onclick="showItemDesc(this)"></div>
        <div class="item-slot" id="slot-2" onclick="showItemDesc(this)"></div>
    </div>

    <div class="game-area">
        <div class="year-display" id="year-display">1789</div>
        <div class="card" id="current-card">
            <div class="card-image" id="card-img">ğŸ‘‘</div>
            <div id="npc-badge" class="npc-badge" style="display:none;">NPC</div>
            <div class="card-title" id="card-speaker">Speaker</div>
            <div class="card-desc" id="card-text">Text</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-left" id="btn-left" 
            onmouseenter="previewEffect('left')" onmouseleave="clearPreview()"
            onclick="playerSwipe('left')">ì¢Œì¸¡ ì„ íƒ</button>
        <button class="btn btn-right" id="btn-right" 
            onmouseenter="previewEffect('right')" onmouseleave="clearPreview()"
            onclick="playerSwipe('right')">ìš°ì¸¡ ì„ íƒ</button>
    </div>
</div>

<div id="item-popup">
    <div class="pop-card">
        <div style="font-size:4rem; margin-bottom:10px;" id="popup-icon">ğŸ</div>
        <h2 style="margin:0 0 10px 0; color:var(--accent);" id="popup-title">ì•„ì´í…œ íšë“!</h2>
        <p id="popup-desc" style="font-size:1rem; line-height:1.5;">ì„¤ëª…</p>
        <button class="btn" style="background:#2c3e50; width:100%; margin-top:20px;" onclick="closePopup()">í™•ì¸</button>
    </div>
</div>

<div id="passive-popup">
    <div class="pop-card" style="border: 3px solid #2ecc71;">
        <div style="font-size:4rem; margin-bottom:10px;" id="passive-icon">ğŸ›¡ï¸</div>
        <h2 style="margin:0 0 10px 0; color:#2ecc71;" id="passive-title">ì•„ì´í…œ íš¨ê³¼ ë°œë™!</h2>
        <p id="passive-desc" style="font-size:1rem; line-height:1.5;">ì„¤ëª…</p>
    </div>
</div>

<div id="ending-overlay">
    <div style="font-size:5rem; margin-bottom:20px;" id="end-icon">ğŸ’€</div>
    <h1 style="font-family:'Cinzel'; margin:0; color:#e74c3c;" id="end-reason">GAME OVER</h1>
    <p id="end-desc" style="font-size:1.2rem; margin:20px 0; max-width:80%;">ì„¤ëª…</p>
    <button class="btn" style="background:white; color:black; width:auto; padding:15px 40px;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
</div>

<script>
    const STATE = { year: 1789, stats: { bread: 50, money: 50, rev: 50, army: 50 }, items: [], deckIndex: 0 };

    const ITEMS = {
        'diamond': { icon: 'ğŸ’', name: 'ë§ˆë¦¬ ì•™íˆ¬ì•„ë„¤íŠ¸ì˜ ë‹¤ì´ì•„', desc: '[íŒ¨ì‹œë¸Œ] êµ­ê³ (ğŸ’°) ê°ì†ŒëŸ‰ì„ ì ˆë°˜ìœ¼ë¡œ ì¤„ì—¬ì¤ë‹ˆë‹¤.' },
        'contract': { icon: 'ğŸ“œ', name: 'ì¸ê°„ê³¼ ì‹œë¯¼ì˜ ê¶Œë¦¬ ì„ ì–¸', desc: '[íŒ¨ì‹œë¸Œ] í˜ëª…(ğŸ”¥) ìˆ˜ì¹˜ê°€ 80ì„ ë„˜ì§€ ì•Šë„ë¡ ì–µì œí•©ë‹ˆë‹¤.' },
        'cannon': { icon: 'ğŸ’£', name: 'ë‚˜í´ë ˆì˜¹ì˜ ëŒ€í¬', desc: '[íŒ¨ì‹œë¸Œ] êµ°ì‚¬(âš”ï¸) ì¦ê°€ëŸ‰ì´ 2ë°°ê°€ ë©ë‹ˆë‹¤.' },
        'bread': { icon: 'ğŸ¥–', name: 'ë¹„ìƒ ì‹ëŸ‰', desc: '[ì†Œëª¨í’ˆ] ë¯¼ì‹¬(ğŸ¥–)ì´ 0ì´ ë  ë•Œ ìë™ ì‚¬ìš©í•˜ì—¬ +40 íšŒë³µí•©ë‹ˆë‹¤.' }
    };

    // [ì¹´ë“œ ë±]
    const HISTORICAL_DECK = [
        { year: 1789, speaker: "ì¬ë¬´ ì¥ê´€ ë„¤ì¼€ë¥´", img: "ğŸ“‰", isNpc: true, text: "ê°í•˜, êµ­ê³ ê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤. ì„¸ê¸ˆì„ ê±·ì„ê¹Œìš”?", left: { text: "ê·¸ëŸ´ ìˆœ ì—†ì†Œ!", effect: { bread: 10, money: -20, rev: 5 } }, right: { text: "ì–´ì©” ìˆ˜ ì—†êµ°. ê±·ì–´ë¼.", effect: { bread: -25, money: 20, rev: 15 } } },
        { year: 1789, speaker: "ì‚¼ë¶€íšŒ", img: "ğŸ—³ï¸", text: "ì œ3ì‹ ë¶„ì´ ë¨¸ë¦¿ìˆ˜ í‘œê²°ì„ ìš”êµ¬í•©ë‹ˆë‹¤.", left: { text: "ë¬´ì‹œí•´!", effect: { rev: 15, bread: -5 } }, right: { text: "ê·¸ë“¤ì˜ ë§ì„ ë“¤ì–´ë³´ì.", effect: { rev: -5, money: -5 } } },
        { year: 1789, speaker: "í…Œë‹ˆìŠ¤ ì½”íŠ¸", img: "âœ‹", text: "ì˜ì›ë“¤ì´ í—Œë²• ì œì • ì „ì—” í•´ì‚°í•˜ì§€ ì•Šê² ë‹¤ê³  í•©ë‹ˆë‹¤.", left: { text: "êµ°ëŒ€ë¡œ ì«“ì•„ë‚´ë¼!", effect: { rev: 25, bread: -10 } }, right: { text: "ë°©ê´€í•˜ë¼.", effect: { rev: 5, army: -5 } } },
        { year: 1789, speaker: "ë°”ìŠ¤í‹°ìœ ", img: "ğŸ°", text: "ì„±ë‚œ êµ°ì¤‘ì´ ë¬´ê¸°ë¥¼ ì°¾ì•„ ë°”ìŠ¤í‹°ìœ ë¡œ ëª°ë ¤ê°‘ë‹ˆë‹¤!", left: { text: "ì˜ì§€ ë§ˆë¼!", effect: { rev: 20, army: -15, bread: 10 } }, right: { text: "ì§„ì••í•˜ë¼!", effect: { rev: 5, army: 10, bread: -30 } } },
        { year: 1789, speaker: "ëŒ€ê³µí¬ (Great Fear)", img: "ğŸ˜±", text: "ì§€ë°© ë†ë¯¼ë“¤ì´ ì˜ì£¼ë“¤ì„ ê³µê²©í•©ë‹ˆë‹¤. ë´‰ê±´ì œë¥¼ íì§€í• ê¹Œìš”?", left: { text: "íì§€ ì„ ì–¸!", effect: { bread: 20, rev: 10, money: -10 } }, right: { text: "êµ°ëŒ€ë¡œ ì§„ì••í•˜ë¼.", effect: { army: -10, bread: -20, rev: 5 } } },
        { year: 1789, speaker: "ë¼íŒŒì˜ˆíŠ¸", img: "âšœï¸", isNpc: true, text: "ì‹œë¯¼ë“¤ì´ ìƒˆë¡œìš´ ê¶Œë¦¬ë¥¼ ì›í•©ë‹ˆë‹¤. [ì¸ê°„ê³¼ ì‹œë¯¼ì˜ ê¶Œë¦¬ ì„ ì–¸]ì„ ë°›ì•„ì£¼ì‹­ì‹œì˜¤.", left: { text: "ì•„ì§ ì‹œê¸°ìƒì¡°ë‹¤.", effect: { rev: -10, bread: -5 } }, right: { text: "ì„œëª…í•˜ê² ì†Œ.", effect: { rev: 10, getItem: 'contract' } } },
        { year: 1789, speaker: "ë¶€ë…€ìë“¤ì˜ í–‰ì§„", img: "ğŸ¥", text: "ë² ë¥´ì‚¬ìœ  ì•ì…ë‹ˆë‹¤! ë¹µì„ ì£¼ì§€ ì•Šìœ¼ë©´ ê¶ìœ¼ë¡œ ì³ë“¤ì–´ê°€ê² ë‹µë‹ˆë‹¤!", left: { text: "ì°½ê³  ê°œë°©!", effect: { bread: 15, money: -15, getItem: 'bread' } }, right: { text: "ë¬´ì‹œí•´ë¼.", effect: { bread: -25, rev: 15 } } },
        
        { year: 1790, speaker: "íƒˆë ˆë‘", img: "âœï¸", isNpc: true, text: "êµíšŒì˜ ë§‰ëŒ€í•œ ì¬ì‚°ì„ ëª°ìˆ˜í•˜ì—¬ êµ­ê³ ë¥¼ ì±„ì›ì‹œë‹¤.", left: { text: "ì‹ ì„±ëª¨ë…ì´ë‹¤!", effect: { money: -10, rev: -5 } }, right: { text: "ëª°ìˆ˜í•˜ë¼!", effect: { money: 30, rev: 5, bread: 5 } } },
        { year: 1790, speaker: "ë‚­ì‹œ ë°˜ë€", img: "âš”ï¸", text: "êµ°ëŒ€ ë‚´ì—ì„œ ë³‘ì‚¬ë“¤ì´ ë°˜ë€ì„ ì¼ìœ¼ì¼°ìŠµë‹ˆë‹¤. ì²˜ë²Œí• ê¹Œìš”?", left: { text: "ëŒ€í™”ë¡œ í•´ê²°í•˜ì.", effect: { army: -10, rev: 5 } }, right: { text: "ë³¸ë³´ê¸°ë¥¼ ë³´ì—¬ì¤˜ë¼!", effect: { army: 15, bread: -10 } } },
        
        { year: 1791, speaker: "ë¯¸ë¼ë³´", img: "âš°ï¸", isNpc: true, text: "í˜ëª…ì˜ ì¤‘ì¬ì ë¯¸ë¼ë³´ê°€ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.", left: { text: "ì• ë„í•˜ë¼.", effect: { bread: 5, rev: 5 } }, right: { text: "ë¬´ì‹œí•´.", effect: { bread: -5 } } },
        { year: 1791, speaker: "ë§ˆë¦¬ ì•™íˆ¬ì•„ë„¤íŠ¸", img: "ğŸ‘¸", isNpc: true, text: "ì—¬ê¸´ ìœ„í—˜í•´ìš”. ì˜¤ìŠ¤íŠ¸ë¦¬ì•„ë¡œ ë„ë§ì³ìš”. [ë‹¤ì´ì•„ëª¬ë“œ]ë¥¼ ì±™ê¸°ì„¸ìš”.", left: { text: "ê±°ì ˆí•œë‹¤.", effect: { rev: -5 } }, right: { text: "ë°›ì•„ë‘ë§ˆ.", effect: { rev: 5, getItem: 'diamond' } } },
        { year: 1791, speaker: "ë°”ë Œ ë„ì£¼", img: "ğŸƒ", text: "ì™•ì´ ë„ë§ì¹˜ë‹¤ ì¡í˜”ìŠµë‹ˆë‹¤. ì²˜ë¶„ì€?", left: { text: "ì™•ê¶Œ ìœ ì§€.", effect: { rev: -15, money: 10 } }, right: { text: "íìœ„í•˜ë¼!", effect: { rev: 25, money: -5 } } },
        { year: 1791, speaker: "ìƒ¹ë“œë§ˆë¥´ìŠ¤", img: "ğŸ”«", text: "ê³µí™”ì •ì„ ìš”êµ¬í•˜ëŠ” ì‹œìœ„ëŒ€ê°€ ëª¨ì˜€ìŠµë‹ˆë‹¤. ë°œí¬í• ê¹Œìš”?", left: { text: "ë°œí¬í•˜ë¼!", effect: { army: 10, bread: -20, rev: -10 } }, right: { text: "ì„¤ë“í•´ë¼.", effect: { army: -5, bread: 5, rev: 5 } } },
        
        { year: 1792, speaker: "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„", img: "âœ‰ï¸", text: "ì™•ì„ ë³µìœ„ì‹œí‚¤ì§€ ì•Šìœ¼ë©´ ì „ìŸì´ë‹¤!", left: { text: "êµ´ë³µí•œë‹¤.", effect: { army: -20, rev: 15 } }, right: { text: "ì „ìŸ ì„ í¬!", effect: { army: 15, money: -25, rev: 5 } } },
        { year: 1792, speaker: "ìƒ í˜ë¡œíŠ¸", img: "ğŸ”¥", text: "ì™•ì´ ì ê³¼ ë‚´í†µí–ˆë‹¤! íŠˆë¥´ë¦¬ ê¶ì „ì„ ìŠµê²©í•˜ì!", left: { text: "ë©ˆì¶°ë¼! ì´ê±´ ë°˜ì—­ì´ë‹¤!", effect: { bread: -15, rev: -10 } }, right: { text: "ì‹œë¯¼ë“¤ì´ì—¬, ë¬´ê¸°ë¥¼ ë“¤ì–´ë¼!", effect: { bread: 15, rev: 20, money: 5 } } },
        { year: 1792, speaker: "ë°œë¯¸ ì „íˆ¬", img: "âš”ï¸", text: "í”„ë¡œì´ì„¼êµ°ì´ íŒŒë¦¬ ê·¼êµê¹Œì§€ ì™”ìŠµë‹ˆë‹¤. ìŠ¹ì‚°ì´ ì—†ìŠµë‹ˆë‹¤.", left: { text: "í›„í‡´í•˜ë¼.", effect: { army: -30, rev: -20 } }, right: { text: "ì£½ì„ ë•Œê¹Œì§€ ì‹¸ì›Œë¼!", effect: { army: 20, rev: 10, bread: 5 } } },
        
        { year: 1793, speaker: "ë£¨ì´ 16ì„¸", img: "ğŸ©¸", text: "êµ­ì™•ì˜ ì²˜ë¶„ì„ ê²°ì •í•˜ì‹­ì‹œì˜¤.", left: { text: "ìë¹„ë¡­ê²Œ ìœ ë°°ë¥¼...", effect: { rev: -15, bread: -10 } }, right: { text: "ë‹¨ë‘ëŒ€ê°€ ë‹µì´ë‹¤!", effect: { rev: 25, bread: 10, army: 5 } } },
        { year: 1793, speaker: "ë§ˆë¼", img: "ğŸ“°", isNpc: true, text: "ë°˜í˜ëª… ë¶„ì 10ë§Œ ëª…ì˜ ëª©ì„ ì³ì•¼ ì¡°êµ­ì´ ì‚½ë‹ˆë‹¤!", left: { text: "ë¯¸ì¹œ ì†Œë¦¬!", effect: { rev: -10 } }, right: { text: "ë™ì˜í•˜ë„¤. ëª…ë‹¨ì„ ê°€ì ¸ì˜¤ê²Œ.", effect: { rev: 20, bread: -5 } } },
        { year: 1793, speaker: "ìƒ¤ë¥¼ë¡œíŠ¸ ì½”ë¥´ë°", img: "ğŸ”ª", isNpc: true, text: "ë‚˜ëŠ” í•œ ì‚¬ëŒ(ë§ˆë¼)ì„ ì£½ì—¬ ì‹­ë§Œ ëª…ì„ êµ¬í–ˆë‹¤.", left: { text: "ì•”ì‚´ë²”ì„ ì²˜í˜•í•˜ë¼!", effect: { rev: 10 } }, right: { text: "ë§ˆë¼ì˜ ì£½ìŒì„ ë¬µì¸í•œë‹¤.", effect: { rev: -10, bread: 5 } } },
        
        { year: 1794, speaker: "ë‹¹í†µ", img: "âš–ï¸", isNpc: true, text: "ì´ì œ ê³µí¬ ì •ì¹˜ë¥¼ ëëƒ…ì‹œë‹¤. ê´€ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.", left: { text: "ì²˜í˜•í•˜ë¼!", effect: { rev: 15, bread: -10 } }, right: { text: "ìë„¤ ë§ì´ ë§ë„¤.", effect: { rev: -15, bread: 10 } } },
        { year: 1794, speaker: "ë¡œë² ìŠ¤í”¼ì—ë¥´", img: "ğŸ“œ", isNpc: true, text: "ê³µí™”êµ­ì˜ ì ë“¤ì„ ëª¨ë‘ ë‹¨ë‘ëŒ€ë¡œ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.", left: { text: "ê·¸ë§Œí•´!", effect: { rev: -20, army: -10 } }, right: { text: "ë™ì˜í•œë‹¤.", effect: { rev: 30, bread: -5 } } },
        { year: 1794, speaker: "í…Œë¥´ë¯¸ë„ë¥´", img: "ğŸ’€", text: "ì˜íšŒì—ì„œ ë¡œë² ìŠ¤í”¼ì—ë¥´ë¥¼ ì²´í¬í•˜ë ¤ í•©ë‹ˆë‹¤.", left: { text: "ë³´í˜¸í•˜ë¼!", effect: { rev: 20, army: -10 } }, right: { text: "ì²´í¬í•´ë¼!", effect: { rev: -30, bread: 10 } } },
        
        { year: 1795, speaker: "ë‚˜í´ë ˆì˜¹", img: "ğŸ’£", isNpc: true, text: "ë°˜ë€êµ° ì§„ì••ì„ ìœ„í•´ ëŒ€í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.", left: { text: "ìœ„í—˜í•˜ë‹¤.", effect: { army: -10 } }, right: { text: "í—ˆê°€í•œë‹¤.", effect: { army: 20, rev: -10, getItem: 'cannon' } } },
        { year: 1797, speaker: "ë°”ëµˆí”„", img: "âœŠ", isNpc: true, text: "ì‚¬ìœ  ì¬ì‚°ì„ ì² íí•˜ê³  í‰ë“±í•œ ì„¸ìƒì„ ë§Œë“­ì‹œë‹¤.", left: { text: "ì²´í¬í•˜ë¼!", effect: { rev: -10, money: 5 } }, right: { text: "ì§€ì§€í•œë‹¤.", effect: { rev: 20, money: -30 } } },
        
        // 1799ë…„ ì—”ë”© ë¶„ê¸°
        { 
            year: 1799, speaker: "ë¸Œë¤¼ë©”ë¥´ 18ì¼", img: "ğŸ›ï¸", 
            text: "ë‚˜í´ë ˆì˜¹ì´ ì¿ ë°íƒ€ë¥¼ ì¼ìœ¼ì¼°ìŠµë‹ˆë‹¤! ê¶Œë ¥ì„ ë„˜ê¸°ì‹œê² ìŠµë‹ˆê¹Œ?", 
            left: { text: "ëê¹Œì§€ ì €í•­í•œë‹¤!", effect: { ending: "RESISTANCE" } }, 
            right: { text: "ì‹œëŒ€ë¥¼ ë°›ì•„ë“¤ì¸ë‹¤.", effect: { ending: "SURVIVAL" } } 
        }
    ];

    const RANDOM_EVENTS = [
        { speaker: "ë¶€íŒ¨í•œ ê´€ë£Œ", img: "ğŸ’°", text: "ë‡Œë¬¼ì„ ë“œë¦´ í…Œë‹ˆ ëˆˆê°ì•„ ì£¼ì‹­ì‹œì˜¤.", left: { text: "ì© êº¼ì ¸ë¼!", effect: { money: -5, bread: 5 } }, right: { text: "ë°›ì•„ë‘ë§ˆ.", effect: { money: 20, rev: -5 } } },
        { speaker: "ì œë¹µì‚¬ ì¡°í•©", img: "ğŸ¥–", text: "ë°€ê°€ë£¨ ê°€ê²©ì„ ì˜¬ë ¤ì£¼ì§€ ì•Šìœ¼ë©´ íŒŒì—…í•˜ê² ìŠµë‹ˆë‹¤.", left: { text: "ì•ˆ ëœë‹¤!", effect: { bread: -15, money: 5 } }, right: { text: "ì˜¬ë ¤ë¼.", effect: { bread: 10, money: -10 } } },
        { speaker: "êµ°ëŒ€ ì‚¬ì—´", img: "ğŸ’‚", text: "êµ°ëŒ€ì˜ ê¸°ê°•ì„ ì¡ì•„ì•¼ í•©ë‹ˆë‹¤.", left: { text: "ì¢€ ì‰¬ê²Œ í•´ì¤˜ë¼.", effect: { army: -10, bread: 5 } }, right: { text: "ì§€ì˜¥ í›ˆë ¨ ì‹¤ì‹œ!", effect: { army: 15, bread: -5 } } },
        { speaker: "ì™¸êµ­ ì‚¬ì ˆ", img: "âœ‰ï¸", text: "í‰í™” ì¡°ì•½ì„ ì œì•ˆí•©ë‹ˆë‹¤.", left: { text: "ê±°ì ˆí•œë‹¤!", effect: { army: 10, money: -5 } }, right: { text: "ìˆ˜ë½í•œë‹¤.", effect: { army: -15, money: 15 } } }
    ];

    let GAME_DECK = [];

    window.startGame = function() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        initGame();
    }

    function initGame() {
        buildDeck();
        updateStatsUI();
        updateInventoryUI();
        loadCard(0);
    }

    function buildDeck() {
        GAME_DECK = [];
        let randomPool = [...RANDOM_EVENTS];
        HISTORICAL_DECK.forEach((histEvent, index) => {
            GAME_DECK.push(histEvent);
            if (index < HISTORICAL_DECK.length - 1 && Math.random() > 0.4) {
                const rIndex = Math.floor(Math.random() * randomPool.length);
                const randomEvt = {...randomPool[rIndex]};
                randomEvt.year = histEvent.year; 
                GAME_DECK.push(randomEvt);
            }
        });
    }

    function loadCard(idx) {
        if (idx >= GAME_DECK.length) return;
        const data = GAME_DECK[idx];
        STATE.year = data.year || STATE.year;
        document.getElementById('year-display').innerText = STATE.year || "???";
        document.getElementById('npc-badge').style.display = data.isNpc ? 'block' : 'none';
        document.getElementById('card-img').innerText = data.img;
        document.getElementById('card-speaker').innerText = data.speaker;
        document.getElementById('card-text').innerText = data.text;
        
        document.getElementById('btn-left').innerText = "â—€ " + data.left.text;
        document.getElementById('btn-right').innerText = data.right.text + " â–¶";

        const card = document.getElementById('current-card');
        card.style.transition = 'none'; 
        card.style.transform = 'translate(0, 0) rotate(0deg)';
        card.style.opacity = 1;
    }

    window.previewEffect = function(dir) {
        const data = GAME_DECK[STATE.deckIndex];
        const effect = (dir === 'left') ? data.left.effect : data.right.effect;
        for(let key in effect) if(STATE.stats.hasOwnProperty(key)) document.getElementById('dot-'+key).style.display = 'block';
    };

    window.clearPreview = function() {
        document.querySelectorAll('.indicator-dot').forEach(dot => dot.style.display = 'none');
    };

    window.playerSwipe = function(direction) {
        clearPreview();
        const card = document.getElementById('current-card');
        const data = GAME_DECK[STATE.deckIndex];
        const choice = direction === 'left' ? data.left : data.right;

        card.style.transition = 'transform 0.3s ease-in, opacity 0.3s ease-in';
        if (direction === 'left') {
            card.classList.add('swipe-left');
        } else {
            card.classList.add('swipe-right');
        }

        setTimeout(() => {
            card.classList.remove('swipe-left', 'swipe-right');
            applyEffect(choice.effect);
            STATE.deckIndex++;
            loadCard(STATE.deckIndex);
        }, 300);
    };

    function applyEffect(effect) {
        if(effect.getItem) addItem(effect.getItem);
        
        if(effect.ending) { 
            triggerEnding(effect.ending); 
            return; 
        }

        let passiveTriggered = false;
        let passiveMsg = "";

        for (let key in effect) {
            if (STATE.stats.hasOwnProperty(key)) {
                let delta = effect[key];
                if (key === 'money' && delta < 0 && hasItem('diamond')) { delta = Math.floor(delta * 0.5); passiveTriggered = true; passiveMsg = "ğŸ’ ë‹¤ì´ì•„ëª¬ë“œê°€ êµ­ê³  ê°ì†Œìœ¨ì„ ë‚®ì¶¤!"; }
                if (key === 'army' && delta > 0 && hasItem('cannon')) { delta = delta * 2; passiveTriggered = true; passiveMsg = "ğŸ’£ ëŒ€í¬ê°€ êµ°ì‚¬ë ¥ì„ ì¦í­!"; }
                STATE.stats[key] += delta;
            }
        }
        
        if (hasItem('contract') && STATE.stats.rev > 80) {
            STATE.stats.rev = 80; passiveTriggered = true; passiveMsg = "ğŸ“œ ì¸ê°„ê³¼ ì‹œë¯¼ì˜ ê¶Œë¦¬ ì„ ì–¸ì´ ê³µí¬ì •ì¹˜ë¥¼ ì–µì œ!";
        }

        if(passiveTriggered) showPassive(passiveMsg);
        checkGameOver();
        updateStatsUI();
    }

    function checkGameOver() {
        const s = STATE.stats;
        let deadReason = null; let deadDesc = ""; let savedByItem = null;

        if (s.bread <= 20 && hasItem('bread')) {
            useItem('bread'); s.bread += 40;
            showPopup("ğŸ¥– ë¹„ìƒ ì‹ëŸ‰ ì‚¬ìš©!", "ë¯¼ì‹¬ì´ í­ë½í•˜ì—¬ ì‹ëŸ‰ì„ í’€ì—ˆìŠµë‹ˆë‹¤ (+40)", "ğŸ¥–");
            updateStatsUI(); return; 
        }

        if (s.bread <= 0) { deadReason = "í­ë™"; deadDesc = "êµ¶ì£¼ë¦° êµ°ì¤‘ì´ ë‹¹ì‹ ì„ ì²˜ë‹¨í–ˆìŠµë‹ˆë‹¤."; }
        else if (s.money <= 0) { deadReason = "íŒŒì‚°"; deadDesc = "êµ­ê°€ ë¶€ë„ë¡œ ì •ë¶€ê°€ ì „ë³µë˜ì—ˆìŠµë‹ˆë‹¤."; }
        else if (s.rev <= 0) { deadReason = "ì™•ì •ë³µê³ "; deadDesc = "í˜ëª…ì´ ì‹¤íŒ¨í•˜ê³  ì™•ì´ ëŒì•„ì™”ìŠµë‹ˆë‹¤."; }
        else if (s.army <= 0) { deadReason = "ì ë ¹"; deadDesc = "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„êµ°ì´ íŒŒë¦¬ë¥¼ ì ë ¹í–ˆìŠµë‹ˆë‹¤."; }
        else if (s.bread >= 100) { deadReason = "ì¤‘ìš°ì •ì¹˜"; deadDesc = "êµ­ê°€ê°€ ë³µì§€ë³‘ìœ¼ë¡œ ë§ˆë¹„ë˜ì—ˆìŠµë‹ˆë‹¤."; }
        else if (s.money >= 100) { deadReason = "ë¶€íŒ¨"; deadDesc = "íƒ€ë½í•œ ê¶Œë ¥ìë¡œ ì²˜í˜•ë‹¹í–ˆìŠµë‹ˆë‹¤."; }
        else if (s.rev >= 100) { deadReason = "ê³µí¬ì •ì¹˜"; deadDesc = "ë‹¨ë‘ëŒ€ì˜ ì´ìŠ¬ë¡œ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤."; }
        else if (s.army >= 100) { deadReason = "êµ°ì‚¬ë…ì¬"; deadDesc = "êµ°ì¸ë“¤ì´ ë‹¹ì‹ ì„ ëª°ì•„ëƒˆìŠµë‹ˆë‹¤."; }

        if (deadReason) triggerEnding(deadReason, deadDesc);
    }

    function hasItem(key) { return STATE.items.includes(key); }
    function addItem(itemKey) {
        if(STATE.items.length >= 3 || STATE.items.includes(itemKey)) return;
        STATE.items.push(itemKey);
        updateInventoryUI();
        const item = ITEMS[itemKey];
        showPopup(item.name + " íšë“!", item.desc, item.icon);
    }
    function useItem(key) {
        const idx = STATE.items.indexOf(key);
        if(idx > -1) { STATE.items.splice(idx, 1); updateInventoryUI(); }
    }
    function showPopup(title, desc, icon="ğŸ") {
        document.getElementById('popup-icon').innerText = icon;
        document.getElementById('popup-title').innerText = title;
        document.getElementById('popup-desc').innerText = desc;
        document.getElementById('item-popup').style.display = 'flex';
    }
    function showPassive(msg) {
        const p = document.getElementById('passive-popup');
        document.getElementById('passive-desc').innerText = msg;
        p.style.display = 'flex';
        setTimeout(() => { p.style.display = 'none'; }, 2000);
    }
    window.closePopup = function() { document.getElementById('item-popup').style.display = 'none'; }
    
    // [ì¤‘ìš” ìˆ˜ì •] ì•„ì´í…œ ë‚´ìš© í‘œì‹œ: ì´ë¦„ + ì„¤ëª… í¬í•¨
    window.showItemDesc = function(slotElement) {
        const tooltipText = slotElement.getAttribute('data-tooltip');
        // íˆ´íŒ í…ìŠ¤íŠ¸ì—ì„œ ì•„ì´í…œ ì´ë¦„ì„ íŒŒì‹± (ì¤„ë°”ê¿ˆ ì•ë¶€ë¶„ë§Œ)
        const itemName = tooltipText.split('\n')[0];
        
        if (itemName && itemName !== "ë¹„ì–´ìˆìŒ") {
            let itemKey = null;
            for(let key in ITEMS) {
                if(ITEMS[key].name === itemName) { itemKey = key; break; }
            }
            if(itemKey) {
                const item = ITEMS[itemKey];
                showPopup(item.name, item.desc, item.icon);
            }
        }
    }

    // [ì¤‘ìš” ìˆ˜ì •] ì¸ë²¤í† ë¦¬ UI ì—…ë°ì´íŠ¸ ì‹œ ì„¤ëª…ë„ ë°ì´í„°ì— í¬í•¨
    function updateInventoryUI() {
        for(let i=0; i<3; i++) {
            const slot = document.getElementById('slot-'+i);
            const itemKey = STATE.items[i];
            if(itemKey) {
                const item = ITEMS[itemKey];
                slot.innerText = item.icon;
                slot.classList.add('active');
                // íˆ´íŒì— ì´ë¦„ê³¼ ì„¤ëª… ê°™ì´ ë„£ìŒ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)
                slot.setAttribute('data-tooltip', item.name + "\n" + item.desc);
            } else {
                slot.innerText = "";
                slot.classList.remove('active');
                slot.setAttribute('data-tooltip', "ë¹„ì–´ìˆìŒ");
            }
        }
    }

    function triggerEnding(type, desc) {
        const overlay = document.getElementById('ending-overlay');
        const rEl = document.getElementById('end-reason');
        const iEl = document.getElementById('end-icon');
        const dEl = document.getElementById('end-desc');

        if(type === "SURVIVAL") {
            rEl.style.color = "#2ecc71";
            iEl.innerText = "ğŸ‘‘";
            rEl.innerText = "ë‚˜í´ë ˆì˜¹ ì œêµ­";
            dEl.innerHTML = "ì¶•í•˜í•©ë‹ˆë‹¤!<br>ê²©ë™ì˜ ì‹œëŒ€ë¥¼ ê²¬ëŒë‚´ê³ <br>ìƒˆë¡œìš´ ì œêµ­ì˜ ê°œêµ­ê³µì‹ ì´ ë˜ì…¨ìŠµë‹ˆë‹¤.";
        } 
        else if(type === "RESISTANCE") {
            rEl.style.color = "#3498db"; 
            iEl.innerText = "ğŸ›ï¸";
            rEl.innerText = "ê³µí™”ì •ì˜ ìˆ˜í˜¸ì";
            dEl.innerHTML = "ë‹¹ì‹ ì€ ì´ì¹¼ ì•ì—ì„œë„ êµ´ë³µí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ë¹„ë¡ ì¿ ë°íƒ€ëŠ” ë§‰ì§€ ëª»í–ˆì§€ë§Œ,<br>ë‹¹ì‹ ì˜ ì‹ ë…ì€ ê³µí™”ì •ì˜ ë¶ˆì”¨ë¡œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.";
        }
        else {
            rEl.style.color = "#c0392b";
            iEl.innerText = "ğŸ’€";
            rEl.innerText = type; 
            dEl.innerText = desc;
        }
        overlay.style.display = 'flex';
    }

    function updateStatsUI() { setBar('bread', STATE.stats.bread); setBar('money', STATE.stats.money); setBar('rev', STATE.stats.rev); setBar('army', STATE.stats.army); }
    function setBar(id, val) {
        val = Math.max(0, Math.min(100, val));
        document.getElementById('fill-'+id).style.height = val + '%';
        const wrapper = document.getElementById('icon-'+id).parentElement;
        if(val <= 20 || val >= 80) wrapper.classList.add('stat-danger'); else wrapper.classList.remove('stat-danger');
    }

</script>
</body>
</html>